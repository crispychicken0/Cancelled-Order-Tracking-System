<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة العروض - Crispy Chicken</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- تقويم -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f9fafb;
        }
        
        /* Sidebar */
        #sidebar {
            transition: transform 0.3s ease;
        }
        
        .sidebar-collapsed .menu-text {
            display: none;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            min-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success {
            border-right: 4px solid #10b981;
        }
        
        .toast-error {
            border-right: 4px solid #ef4444;
        }
        
        .toast-info {
            border-right: 4px solid #3b82f6;
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        /* Utility */
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            #sidebar {
                transform: translateX(100%);
            }
            
            #sidebar.open {
                transform: translateX(0);
            }
        }
        
        /* Loading */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Offer type badges */
        .badge-fixed {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .badge-flash {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .badge-value {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        /* Status badges */
        .badge-active {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .badge-inactive {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f9fafb;
        }
        
        /* Login page */
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }
        
        /* Calendar */
        .calendar-container {
            max-width: 100%;
        }
        
        /* Form validation */
        .input-error {
            border-color: #ef4444 !important;
        }
        
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        /* Marketing campaign cards */
        .campaign-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .campaign-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Data table */
        .data-table {
            overflow-x: auto;
        }
        
        .data-table table {
            min-width: 600px;
        }
        
        /* Tabs */
        .tab.active {
            border-bottom: 2px solid #f59e0b;
            color: #f59e0b;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        /* Performance input styles */
        .performance-input {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .performance-input h4 {
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        /* Weekly comparison */
        .week-comparison {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .week-comparison .week-label {
            font-weight: 600;
            color: #92400e;
        }
        
        .week-comparison .comparison-value {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .week-comparison .positive {
            color: #059669;
        }
        
        .week-comparison .negative {
            color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Section (Initially hidden after auth implementation) -->
    <section id="loginSection" class="login-container hidden">
        <div class="login-card">
            <div class="p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-chicken text-5xl text-orange-500"></i>
                    <h2 class="text-2xl font-bold mt-4">تسجيل الدخول</h2>
                    <p class="text-gray-600">نظام إدارة العروض - Crispy Chicken</p>
                </div>
                
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="email" class="block text-sm font-medium mb-1">البريد الإلكتروني</label>
                        <input type="email" id="email" class="w-full px-4 py-2 border rounded-lg focus:ring-orange-500 focus:border-orange-500" required>
                        <div id="emailError" class="error-message hidden">يرجى إدخال بريد إلكتروني صحيح</div>
                    </div>
                    
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium mb-1">كلمة المرور</label>
                        <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:ring-orange-500 focus:border-orange-500" required>
                        <div id="passwordError" class="error-message hidden">كلمة المرور يجب أن تكون 6 أحرف على الأقل</div>
                    </div>
                    
                    <div class="mb-4">
                        <button type="submit" class="w-full bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition">تسجيل الدخول</button>
                    </div>
                    
                    <div class="text-center">
                        <a href="#" class="text-sm text-orange-600 hover:text-orange-700">نسيت كلمة المرور؟</a>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    <!-- Main App (Initially hidden until auth) -->
    <div id="appContainer" class="hidden">
        <!-- Toast Container -->
        <div id="toastContainer"></div>
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-600">جاري التحميل...</p>
            </div>
        </div>
        
        <!-- Header -->
        <header class="bg-white shadow-sm border-b sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <i class="fas fa-chicken text-2xl text-orange-500 ml-3"></i>
                        <h1 class="text-xl font-bold">نظام إدارة العروض - Crispy Chicken</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <button class="text-gray-600 hover:text-orange-500 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                        </button>
                        <div class="relative">
                            <button id="profileBtn" class="flex items-center gap-2">
                                <img src="https://placehold.co/40x40" alt="User" class="w-10 h-10 rounded-full">
                                <span class="hidden md:block">أحمد كناوي</span>
                            </button>
                            <div id="profileMenu" class="absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg hidden">
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100">الملف الشخصي</a>
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100">الإعدادات</a>
                                <hr>
                                <a href="#" id="logoutBtn" class="block px-4 py-2 hover:bg-gray-100 text-red-600">تسجيل الخروج</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="w-64 bg-gray-900 text-white fixed h-full z-30">
                <div class="p-4 border-b border-gray-700">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-chicken-hat text-2xl text-orange-500"></i>
                        <span class="text-xl font-semibold">Crispy Chicken</span>
                    </div>
                </div>
                <nav class="p-4">
                    <a href="#" data-section="dashboard" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2 bg-gray-800">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>لوحة التحكم</span>
                    </a>
                    <a href="#" data-section="offers" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2">
                        <i class="fas fa-tags"></i>
                        <span>إدارة العروض</span>
                    </a>
                    <a href="#" data-section="analytics" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2">
                        <i class="fas fa-chart-line"></i>
                        <span>التحليلات</span>
                    </a>
                    <a href="#" data-section="marketing" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2">
                        <i class="fas fa-bullhorn"></i>
                        <span>التسويق</span>
                    </a>
                    <a href="#" data-section="sheets" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2">
                        <i class="fas fa-table"></i>
                        <span>الجداول</span>
                    </a>
                    <a href="#" data-section="data-entry" class="nav-item flex items-center gap-3 p-3 rounded hover:bg-gray-800 mb-2">
                        <i class="fas fa-keyboard"></i>
                        <span>إدخال البيانات</span>
                    </a>
                </nav>
            </aside>
            
            <!-- Sidebar Overlay -->
            <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden"></div>
            
            <!-- Main Content -->
            <main class="flex-1 lg:mr-64">
                <!-- Sub Header -->
                <div class="bg-white shadow-sm p-4 sticky top-16 z-20">
                    <div class="flex items-center justify-between">
                        <button id="mobileMenuBtn" class="lg:hidden">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <div class="flex-1 max-w-xs mx-4">
                            <input type="text" placeholder="بحث..." class="w-full px-4 py-2 border rounded-full">
                        </div>
                        <button id="addOfferBtn" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600">
                            <i class="fas fa-plus ml-2"></i>إنشاء عرض جديد
                        </button>
                    </div>
                </div>
                
                <!-- Content Area -->
                <div class="p-6">
                    <!-- Dashboard Section -->
                    <section id="dashboardSection" class="section">
                        <h2 class="text-2xl font-bold mb-6">لوحة التحكم</h2>
                        
                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="bg-orange-100 p-3 rounded-lg">
                                        <i class="fas fa-tags text-orange-600 text-xl"></i>
                                    </div>
                                    <span class="text-green-600">+12%</span>
                                </div>
                                <h3 class="text-2xl font-bold">6</h3>
                                <p class="text-gray-600">إجمالي العروض النشطة</p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="bg-green-100 p-3 rounded-lg">
                                        <i class="fas fa-money-bill-wave text-green-600 text-xl"></i>
                                    </div>
                                    <span class="text-green-600">+8.5%</span>
                                </div>
                                <h3 class="text-2xl font-bold">$28,725</h3>
                                <p class="text-gray-600">إجمالي الإيرادات</p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="bg-blue-100 p-3 rounded-lg">
                                        <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                                    </div>
                                    <span class="text-green-600">+15.3%</span>
                                </div>
                                <h3 class="text-2xl font-bold">1,166</h3>
                                <p class="text-gray-600">إجمالي الاستخدامات</p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="bg-purple-100 p-3 rounded-lg">
                                        <i class="fas fa-star text-purple-600 text-xl"></i>
                                    </div>
                                    <span class="text-green-600">+2.1%</span>
                                </div>
                                <h3 class="text-2xl font-bold">4.8</h3>
                                <p class="text-gray-600">متوسط التقييم</p>
                            </div>
                        </div>
                        
                        <!-- Weekly Performance Summary -->
                        <div class="bg-white rounded-lg shadow p-6 mb-8">
                            <h3 class="text-lg font-semibold mb-4">ملخص الأداء الأسبوعي</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="week-comparison">
                                    <div class="week-label">الأسبوع الحالي</div>
                                    <div class="comparison-value">156 طلب</div>
                                    <div class="text-sm positive">+12% عن الأسبوع الماضي</div>
                                </div>
                                <div class="week-comparison">
                                    <div class="week-label">الأسبوع الماضي</div>
                                    <div class="comparison-value">139 طلب</div>
                                    <div class="text-sm negative">-5% عن أسبوعين</div>
                                </div>
                                <div class="week-comparison">
                                    <div class="week-label">متوسط الشهر</div>
                                    <div class="comparison-value">142 طلب</div>
                                    <div class="text-sm positive">+8% عن الشهر الماضي</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">أداء العروض حسب النوع</h3>
                                <div class="chart-container">
                                    <canvas id="offersChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">إيرادات العروض الشهرية</h3>
                                <div class="chart-container">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Offers -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4">العروض الحالية</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-right p-2">العرض</th>
                                            <th class="text-right p-2">النوع</th>
                                            <th class="text-right p-2">الحالة</th>
                                            <th class="text-right p-2">الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dashboardOffersTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Offers Section -->
                    <section id="offersSection" class="section hidden">
                        <h2 class="text-2xl font-bold mb-6">إدارة العروض</h2>
                        
                        <!-- Tabs -->
                        <div class="bg-white rounded-lg shadow-sm mb-6">
                            <div class="flex border-b">
                                <button class="tab px-4 py-2 font-medium active" data-tab="offers-list">قائمة العروض</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="create-offer">إنشاء عرض جديد</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="offer-calendar">تقويم العروض</button>
                            </div>
                        </div>
                        
                        <!-- Offers List Tab -->
                        <div id="offers-list" class="tab-content">
                            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                                <div class="flex flex-wrap gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">نوع العرض</label>
                                        <select id="filterType" class="w-full px-3 py-2 border rounded">
                                            <option value="">الكل</option>
                                            <option value="fixed">عروض ثابتة</option>
                                            <option value="flash">عروض محدودة</option>
                                            <option value="value">عروض القيمة المضافة</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">الحالة</label>
                                        <select id="filterStatus" class="w-full px-3 py-2 border rounded">
                                            <option value="">الكل</option>
                                            <option value="active">نشط</option>
                                            <option value="inactive">منتهي</option>
                                        </select>
                                    </div>
                                    <div class="ml-auto">
                                        <button onclick="app.applyFilters()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-filter ml-2"></i>تطبيق الفلاتر
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Offers Grid -->
                            <div id="offersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Create Offer Tab -->
                        <div id="create-offer" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">إنشاء عرض جديد</h3>
                                <form id="createOfferForm" class="space-y-4">
                                    <input type="hidden" id="offerId" value="">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">اسم العرض *</label>
                                            <input type="text" id="offerName" class="w-full px-3 py-2 border rounded" required>
                                            <div id="offerNameError" class="error-message hidden">يرجى إدخال اسم العرض</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">نوع العرض *</label>
                                            <select id="offerType" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر النوع</option>
                                                <option value="fixed">عروض ثابتة</option>
                                                <option value="flash">عروض محدودة</option>
                                                <option value="value">عروض القيمة المضافة</option>
                                            </select>
                                            <div id="offerTypeError" class="error-message hidden">يرجى اختيار نوع العرض</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">تاريخ البدء *</label>
                                            <input type="text" id="startDate" class="datepicker w-full px-3 py-2 border rounded" required>
                                            <div id="startDateError" class="error-message hidden">يرجى اختيار تاريخ البدء</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">تاريخ الانتهاء *</label>
                                            <input type="text" id="endDate" class="datepicker w-full px-3 py-2 border rounded" required>
                                            <div id="endDateError" class="error-message hidden">يرجى اختيار تاريخ الانتهاء</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">السعر الأصلي *</label>
                                            <input type="number" id="originalPrice" step="0.01" min="0" class="w-full px-3 py-2 border rounded" required>
                                            <div id="originalPriceError" class="error-message hidden">يرجى إدخال السعر الأصلي</div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">السعر بعد الخصم *</label>
                                            <input type="number" id="discountPrice" step="0.01" min="0" class="w-full px-3 py-2 border rounded" required>
                                            <div id="discountPriceError" class="error-message hidden">يرجى إدخال السعر بعد الخصم</div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">وصف العرض *</label>
                                        <textarea id="offerDescription" class="w-full px-3 py-2 border rounded" rows="3" required></textarea>
                                        <div id="offerDescriptionError" class="error-message hidden">يرجى إدخال وصف العرض</div>
                                    </div>
                                    
                                    <!-- Performance Data Section -->
                                    <div class="performance-input">
                                        <h4><i class="fas fa-chart-line ml-2"></i>بيانات الأداء (للتحليل)</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                            <div>
                                                <label class="block text-sm font-medium mb-1">عدد الطلبات *</label>
                                                <input type="number" id="orderCount" min="0" class="w-full px-3 py-2 border rounded" required>
                                                <div id="orderCountError" class="error-message hidden">يرجى إدخال عدد الطلبات</div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">إجمالي الإيرادات *</label>
                                                <input type="number" id="totalRevenue" step="0.01" min="0" class="w-full px-3 py-2 border rounded" required>
                                                <div id="totalRevenueError" class="error-message hidden">يرجى إدخال الإيرادات</div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">متوسط وقت الانتظار (دقائق)</label>
                                                <input type="number" id="avgWaitTime" step="0.1" min="0" class="w-full px-3 py-2 border rounded">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">معدل الرضا (%)</label>
                                                <input type="number" id="satisfactionRate" min="0" max="100" class="w-full px-3 py-2 border rounded">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center">
                                        <input type="checkbox" id="isActive" class="ml-2" checked>
                                        <label for="isActive" class="text-sm font-medium">تفعيل العرض فوراً</label>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" onclick="app.resetOfferForm()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                                        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">حفظ العرض</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Offer Calendar Tab -->
                        <div id="offer-calendar" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">تقويم العروض</h3>
                                <div id="calendar" class="calendar-container"></div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Analytics Section -->
                    <section id="analyticsSection" class="section hidden">
                        <h2 class="text-2xl font-bold mb-6">التحليلات</h2>
                        
                        <!-- Analytics Filters -->
                        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                            <div class="flex flex-wrap gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">الفترة</label>
                                    <select id="analyticsPeriod" class="w-full px-3 py-2 border rounded">
                                        <option value="week">أسبوعي</option>
                                        <option value="month">شهري</option>
                                        <option value="quarter">ربع سنوي</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">نوع العرض</label>
                                    <select id="analyticsOfferType" class="w-full px-3 py-2 border rounded">
                                        <option value="">الكل</option>
                                        <option value="fixed">عروض ثابتة</option>
                                        <option value="flash">عروض محدودة</option>
                                        <option value="value">عروض القيمة المضافة</option>
                                    </select>
                                </div>
                                <div class="ml-auto">
                                    <button onclick="app.updateAnalytics()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
                                        <i class="fas fa-filter ml-2"></i>تحديث التحليل
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Weekly Comparison Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">مقارنة الأسبوع الحالي</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>عدد الطلبات</span>
                                        <span class="font-bold">156</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>مقارنة بالأسبوع الماضي</span>
                                        <span class="text-green-600">+12%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>مقارنة بمتوسط الشهر</span>
                                        <span class="text-green-600">+9.8%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">أفضل أداء أسبوعي</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>الأسبوع</span>
                                        <span class="font-bold">الأسبوع 2</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>عدد الطلبات</span>
                                        <span class="font-bold">189</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>الإيرادات</span>
                                        <span class="font-bold">$4,725</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">توقعات الأسبوع القادم</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span>عدد الطلبات المتوقع</span>
                                        <span class="font-bold">165</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>نمو متوقع</span>
                                        <span class="text-green-600">+5.8%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>العروض المخططة</span>
                                        <span class="font-bold">3 عروض</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analytics Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">مقارنة الأداء الأسبوعي</h3>
                                <div class="chart-container">
                                    <canvas id="weeklyPerformanceChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow">
                                <h3 class="text-lg font-semibold mb-4">توزيع العروض حسب الأسبوع</h3>
                                <div class="chart-container">
                                    <canvas id="weeklyOffersChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Weekly Table -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">تفاصيل الأداء الأسبوعي</h3>
                            <div class="data-table">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-right p-2">الأسبوع</th>
                                            <th class="text-right p-2">العرض</th>
                                            <th class="text-right p-2">عدد الطلبات</th>
                                            <th class="text-right p-2">الإيرادات</th>
                                            <th class="text-right p-2">مقارنة بالأسبوع السابق</th>
                                            <th class="text-right p-2">ملاحظات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="weeklyPerformanceTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Marketing Section -->
                    <section id="marketingSection" class="section hidden">
                        <h2 class="text-2xl font-bold mb-6">التسويق</h2>
                        
                        <!-- Marketing Tabs -->
                        <div class="bg-white rounded-lg shadow-sm mb-6">
                            <div class="flex border-b">
                                <button class="tab px-4 py-2 font-medium active" data-tab="campaigns-list">الحملات التسويقية</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="create-campaign">إنشاء حملة جديدة</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="campaign-analytics">تحليل الحملات</button>
                            </div>
                        </div>
                        
                        <!-- Campaigns List Tab -->
                        <div id="campaigns-list" class="tab-content">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Campaign Card 1 -->
                                <div class="campaign-card bg-white rounded-lg shadow p-6">
                                    <div class="flex justify-between mb-4">
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm">نشط</span>
                                        <span class="text-gray-500 text-sm">منذ 5 أيام</span>
                                    </div>
                                    <h3 class="text-lg font-semibold mb-2">حملة رمضان</h3>
                                    <p class="text-gray-600 mb-4">عروض خاصة بشهر رمضان المبارك</p>
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p class="text-sm text-gray-500">الوصول</p>
                                            <p class="text-lg font-bold">24,568</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التفاعل</p>
                                            <p class="text-lg font-bold">3,456</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التحويلات</p>
                                            <p class="text-lg font-bold">456</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التكلفة</p>
                                            <p class="text-lg font-bold">$1,200</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                            <i class="fas fa-edit ml-1"></i>تعديل
                                        </button>
                                        <button class="flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                                            <i class="fas fa-chart-bar ml-1"></i>تحليل
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Campaign Card 2 -->
                                <div class="campaign-card bg-white rounded-lg shadow p-6">
                                    <div class="flex justify-between mb-4">
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded text-sm">مكتمل</span>
                                        <span class="text-gray-500 text-sm">منذ 15 يوم</span>
                                    </div>
                                    <h3 class="text-lg font-semibold mb-2">حملة العودة للمدرسة</h3>
                                    <p class="text-gray-600 mb-4">عروض خاصة بمناسبة العودة للمدارس</p>
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p class="text-sm text-gray-500">الوصول</p>
                                            <p class="text-lg font-bold">18,234</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التفاعل</p>
                                            <p class="text-lg font-bold">2,345</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التحويلات</p>
                                            <p class="text-lg font-bold">345</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">التكلفة</p>
                                            <p class="text-lg font-bold">$980</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                            <i class="fas fa-copy ml-1"></i>نسخ
                                        </button>
                                        <button class="flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                                            <i class="fas fa-chart-bar ml-1"></i>تحليل
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Campaign Card 3 -->
                                <div class="campaign-card bg-white rounded-lg shadow p-6">
                                    <div class="flex justify-between mb-4">
                                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded text-sm">مجدول</span>
                                        <span class="text-gray-500 text-sm">تبدأ بعد 3 أيام</span>
                                    </div>
                                    <h3 class="text-lg font-semibold mb-2">حملة العيد الوطني</h3>
                                    <p class="text-gray-600 mb-4">احتفالات العيد الوطني بعروض خاصة</p>
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p class="text-sm text-gray-500">الميزانية</p>
                                            <p class="text-lg font-bold">$2,500</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">المدة</p>
                                            <p class="text-lg font-bold">7 أيام</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">المنصة</p>
                                            <p class="text-lg font-bold">جميعها</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">الجمهور</p>
                                            <p class="text-lg font-bold">الكل</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                                            <i class="fas fa-edit ml-1"></i>تعديل
                                        </button>
                                        <button class="flex-1 px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200">
                                            <i class="fas fa-trash ml-1"></i>حذف
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Create Campaign Tab -->
                        <div id="create-campaign" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">إنشاء حملة جديدة</h3>
                                <form id="createCampaignForm" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">اسم الحملة</label>
                                            <input type="text" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">نوع الحملة</label>
                                            <select class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر النوع</option>
                                                <option value="social">وسائل التواصل الاجتماعي</option>
                                                <option value="email">بريد إلكتروني</option>
                                                <option value="sms">رسائل نصية</option>
                                                <option value="ads">إعلانات مدفوعة</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">تاريخ البدء</label>
                                            <input type="text" class="datepicker w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">تاريخ الانتهاء</label>
                                            <input type="text" class="datepicker w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الميزانية</label>
                                            <input type="number" step="0.01" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الجمهور المستهدف</label>
                                            <select class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر الجمهور</option>
                                                <option value="all">الجميع</option>
                                                <option value="new">عملاء جدد</option>
                                                <option value="returning">عملاء عائدين</option>
                                                <option value="vip">عملاء VIP</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">وصف الحملة</label>
                                        <textarea class="w-full px-3 py-2 border rounded" rows="3" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">العرض المرتبط</label>
                                        <select class="w-full px-3 py-2 border rounded">
                                            <option value="">اختر عرض</option>
                                            <option value="OFF001">عرض الاثنين والثلاثاء</option>
                                            <option value="OFF002">عرض سريع 20%</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Campaign Performance Data -->
                                    <div class="performance-input">
                                        <h4><i class="fas fa-chart-line ml-2"></i>بيانات أداء الحملة</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                            <div>
                                                <label class="block text-sm font-medium mb-1">الوصول المتوقع</label>
                                                <input type="number" min="0" class="w-full px-3 py-2 border rounded">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">معدل التفاعل المتوقع (%)</label>
                                                <input type="number" min="0" max="100" class="w-full px-3 py-2 border rounded">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">التحويلات المتوقعة</label>
                                                <input type="number" min="0" class="w-full px-3 py-2 border rounded">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">التكلفة لكل تحويل</label>
                                                <input type="number" step="0.01" min="0" class="w-full px-3 py-2 border rounded">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center">
                                        <input type="checkbox" id="campaignActive" class="ml-2" checked>
                                        <label for="campaignActive" class="text-sm font-medium">تفعيل الحملة فوراً</label>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                                        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">حفظ الحملة</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Campaign Analytics Tab -->
                        <div id="campaign-analytics" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">تحليل أداء الحملات</h3>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="chart-container">
                                        <canvas id="campaignPerformanceChart"></canvas>
                                    </div>
                                    <div class="chart-container">
                                        <canvas id="campaignROIChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Sheets Section -->
                    <section id="sheetsSection" class="section hidden">
                        <h2 class="text-2xl font-bold mb-6">الجداول</h2>
                        
                        <!-- Sheets Tabs -->
                        <div class="bg-white rounded-lg shadow-sm mb-6">
                            <div class="flex border-b">
                                <button class="tab px-4 py-2 font-medium active" data-tab="offers-data">بيانات العروض</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="weekly-data">البيانات الأسبوعية</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="campaign-data">بيانات الحملات</button>
                            </div>
                        </div>
                        
                        <!-- Offers Data Tab -->
                        <div id="offers-data" class="tab-content">
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">بيانات العروض</h3>
                                    <div class="flex gap-2">
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-filter ml-1"></i>فلترة
                                        </button>
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-download ml-1"></i>تصدير
                                        </button>
                                    </div>
                                </div>
                                <div class="data-table">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="text-right p-2">كود العرض</th>
                                                <th class="text-right p-2">اسم العرض</th>
                                                <th class="text-right p-2">النوع</th>
                                                <th class="text-right p-2">عدد الطلبات</th>
                                                <th class="text-right p-2">الإيرادات</th>
                                                <th class="text-right p-2">متوسط الانتظار</th>
                                                <th class="text-right p-2">معدل الرضا</th>
                                                <th class="text-right p-2">الحالة</th>
                                            </tr>
                                        </thead>
                                        <tbody id="offersDataTable">
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Weekly Data Tab -->
                        <div id="weekly-data" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">البيانات الأسبوعية</h3>
                                    <div class="flex gap-2">
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-filter ml-1"></i>فلترة
                                        </button>
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-download ml-1"></i>تصدير
                                        </button>
                                    </div>
                                </div>
                                <div class="data-table">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="text-right p-2">الأسبوع</th>
                                                <th class="text-right p-2">العرض</th>
                                                <th class="text-right p-2">عدد الطلبات</th>
                                                <th class="text-right p-2">الإيرادات</th>
                                                <th class="text-right p-2">مقارنة بالأسبوع السابق</th>
                                                <th class="text-right p-2">ملاحظات</th>
                                            </tr>
                                        </thead>
                                        <tbody id="weeklyDataTable">
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Campaign Data Tab -->
                        <div id="campaign-data" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">بيانات الحملات</h3>
                                    <div class="flex gap-2">
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-filter ml-1"></i>فلترة
                                        </button>
                                        <button class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
                                            <i class="fas fa-download ml-1"></i>تصدير
                                        </button>
                                    </div>
                                </div>
                                <div class="data-table">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="text-right p-2">الحملة</th>
                                                <th class="text-right p-2">النوع</th>
                                                <th class="text-right p-2">الوصول</th>
                                                <th class="text-right p-2">التحويلات</th>
                                                <th class="text-right p-2">التكلفة</th>
                                                <th class="text-right p-2">العائد على الاستثمار</th>
                                                <th class="text-right p-2">الحالة</th>
                                            </tr>
                                        </thead>
                                        <tbody id="campaignDataTable">
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Data Entry Section -->
                    <section id="dataEntrySection" class="section hidden">
                        <h2 class="text-2xl font-bold mb-6">إدخال البيانات</h2>
                        
                        <!-- Data Entry Tabs -->
                        <div class="bg-white rounded-lg shadow-sm mb-6">
                            <div class="flex border-b">
                                <button class="tab px-4 py-2 font-medium active" data-tab="weekly-performance">الأداء الأسبوعي</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="marketing-data">بيانات التسويق</button>
                                <button class="tab px-4 py-2 font-medium" data-tab="customer-feedback">ملاحظات العملاء</button>
                            </div>
                        </div>
                        
                        <!-- Weekly Performance Tab -->
                        <div id="weekly-performance" class="tab-content">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">إدخال بيانات الأداء الأسبوعي</h3>
                                <form id="weeklyPerformanceForm" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الأسبوع</label>
                                            <select id="weekNumber" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر الأسبوع</option>
                                                <option value="1">الأسبوع 1</option>
                                                <option value="2">الأسبوع 2</option>
                                                <option value="3">الأسبوع 3</option>
                                                <option value="4">الأسبوع 4</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الشهر</label>
                                            <select id="monthNumber" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر الشهر</option>
                                                <option value="1">يناير 2025</option>
                                                <option value="2">فبراير 2025</option>
                                                <option value="3">مارس 2025</option>
                                                <option value="4">أبريل 2025</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">العرض الرئيسي</label>
                                            <select id="mainOffer" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر العرض</option>
                                                <option value="12-piece">12 قطعة</option>
                                                <option value="8-piece">8 قطع</option>
                                                <option value="family">وجبة عائلية</option>
                                                <option value="none">لا يوجد عرض</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">عدد الطلبات *</label>
                                            <input type="number" id="weeklyOrders" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">إجمالي الإيرادات *</label>
                                            <input type="number" id="weeklyRevenue" step="0.01" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">متوسط وقت الانتظار (دقائق)</label>
                                            <input type="number" id="weeklyWaitTime" step="0.1" min="0" class="w-full px-3 py-2 border rounded">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">معدل الرضا (%)</label>
                                            <input type="number" id="weeklySatisfaction" min="0" max="100" class="w-full px-3 py-2 border rounded">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">عدد الشكاوى</label>
                                            <input type="number" id="weeklyComplaints" min="0" class="w-full px-3 py-2 border rounded">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">ملاحظات الأسبوع</label>
                                        <textarea id="weeklyNotes" class="w-full px-3 py-2 border rounded" rows="3"></textarea>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" onclick="app.resetWeeklyForm()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                                        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">حفظ البيانات</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Marketing Data Tab -->
                        <div id="marketing-data" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">إدخال بيانات التسويق</h3>
                                <form id="marketingDataForm" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الحملة</label>
                                            <select id="marketingCampaign" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر الحملة</option>
                                                <option value="social">وسائل التواصل</option>
                                                <option value="email">بريد إلكتروني</option>
                                                <option value="sms">رسائل نصية</option>
                                                <option value="ads">إعلانات</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التاريخ</label>
                                            <input type="text" id="marketingDate" class="datepicker w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">الوصول *</label>
                                            <input type="number" id="marketingReach" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التفاعل *</label>
                                            <input type="number" id="marketingEngagement" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التحويلات *</label>
                                            <input type="number" id="marketingConversions" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التكلفة *</label>
                                            <input type="number" id="marketingCost" step="0.01" min="0" class="w-full px-3 py-2 border rounded" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">ملاحظات الحملة</label>
                                        <textarea id="marketingNotes" class="w-full px-3 py-2 border rounded" rows="3"></textarea>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" onclick="app.resetMarketingForm()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                                        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">حفظ البيانات</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Customer Feedback Tab -->
                        <div id="customer-feedback" class="tab-content hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">إدخال ملاحظات العملاء</h3>
                                <form id="customerFeedbackForm" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التاريخ</label>
                                            <input type="text" id="feedbackDate" class="datepicker w-full px-3 py-2 border rounded" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">نوع الملاحظة</label>
                                            <select id="feedbackType" class="w-full px-3 py-2 border rounded" required>
                                                <option value="">اختر النوع</option>
                                                <option value="complaint">شكوى</option>
                                                <option value="suggestion">اقتراح</option>
                                                <option value="compliment">إشادة</option>
                                                <option value="inquiry">استفسار</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">التقييم (1-5)</label>
                                            <select id="feedbackRating" class="w-full px-3 py-2 border rounded">
                                                <option value="">اختر التقييم</option>
                                                <option value="1">1 - سيء جداً</option>
                                                <option value="2">2 - سيء</option>
                                                <option value="3">3 - متوسط</option>
                                                <option value="4">4 - جيد</option>
                                                <option value="5">5 - ممتاز</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">القسم المعني</label>
                                            <select id="feedbackDepartment" class="w-full px-3 py-2 border rounded">
                                                <option value="">اختر القسم</option>
                                                <option value="service">الخدمة</option>
                                                <option value="quality">الجودة</option>
                                                <option value="delivery">التوصيل</option>
                                                <option value="pricing">الأسعار</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">نص الملاحظة *</label>
                                        <textarea id="feedbackText" class="w-full px-3 py-2 border rounded" rows="4" required></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">الإجراءات المتخذة</label>
                                        <textarea id="feedbackActions" class="w-full px-3 py-2 border rounded" rows="3"></textarea>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" onclick="app.resetFeedbackForm()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                                        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">حفظ الملاحظة</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-4">تأكيد الحذف</h3>
            <p class="text-gray-600 mb-6">هل أنت متأكد من حذف هذا العرض؟ لا يمكن التراجع عن هذا الإجراء.</p>
            <div class="flex justify-end gap-3">
                <button onclick="app.closeDeleteModal()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">إلغاء</button>
                <button onclick="app.confirmDelete()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">حذف</button>
            </div>
        </div>
    </div>
    
    <script>
        // Declare app in the global scope
        let app;
        
        class App {
            constructor() {
                this.currentSection = 'dashboard';
                this.charts = {};
                this.isAuthenticated = false;
                this.offers = JSON.parse(localStorage.getItem('offers')) || this.getDefaultOffers();
                this.weeklyData = JSON.parse(localStorage.getItem('weeklyData')) || [];
                this.marketingData = JSON.parse(localStorage.getItem('marketingData')) || [];
                this.customerFeedback = JSON.parse(localStorage.getItem('customerFeedback')) || [];
                this.currentOfferId = null;
                this.deleteOfferId = null;
                this.chartConfigs = {
                    offers: {
                        type: 'doughnut',
                        data: {
                            labels: ['عروض ثابتة', 'عروض محدودة', 'قيمة مضافة', 'عروض منصات'],
                            datasets: [{
                                data: [30, 25, 20, 25],
                                backgroundColor: ['#F59E0B', '#3B82F6', '#10B981', '#EC4899']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    },
                    revenue: {
                        type: 'line',
                        data: {
                            labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                            datasets: [{
                                label: 'الإيرادات',
                                data: [12000, 19000, 15000, 25000, 22000, 30000],
                                borderColor: '#F59E0B',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    },
                    weeklyPerformance: {
                        type: 'bar',
                        data: {
                            labels: ['الأسبوع 1', 'الأسبوع 2', 'الأسبوع 3', 'الأسبوع 4'],
                            datasets: [{
                                label: 'عدد الطلبات',
                                data: [120, 189, 156, 145],
                                backgroundColor: '#3B82F6'
                            }, {
                                label: 'الإيرادات',
                                data: [3000, 4725, 3900, 3625],
                                backgroundColor: '#10B981'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    },
                    weeklyOffers: {
                        type: 'line',
                        data: {
                            labels: ['الأسبوع 1', 'الأسبوع 2', 'الأسبوع 3', 'الأسبوع 4'],
                            datasets: [{
                                label: '12 قطعة',
                                data: [45, 78, 89, 67],
                                borderColor: '#F59E0B',
                                tension: 0.4
                            }, {
                                label: '8 قطع',
                                data: [35, 56, 34, 45],
                                borderColor: '#3B82F6',
                                tension: 0.4
                            }, {
                                label: 'وجبة عائلية',
                                data: [40, 55, 33, 33],
                                borderColor: '#10B981',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    },
                    campaignPerformance: {
                        type: 'bar',
                        data: {
                            labels: ['وسائل التواصل', 'بريد إلكتروني', 'رسائل نصية', 'إعلانات'],
                            datasets: [{
                                label: 'الوصول',
                                data: [24568, 18234, 9876, 15432],
                                backgroundColor: '#3B82F6'
                            }, {
                                label: 'التحويلات',
                                data: [456, 345, 234, 387],
                                backgroundColor: '#10B981'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    },
                    campaignROI: {
                        type: 'doughnut',
                        data: {
                            labels: ['وسائل التواصل', 'بريد إلكتروني', 'رسائل نصية', 'إعلانات'],
                            datasets: [{
                                data: [380, 252, 168, 294],
                                backgroundColor: ['#F59E0B', '#3B82F6', '#10B981', '#EC4899']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    }
                };
                this.init();
            }
            
            getDefaultOffers() {
                return [
                    {
                        id: 'OFF001',
                        name: 'عرض الاثنين والثلاثاء',
                        type: 'fixed',
                        description: '12 قطعة دجاج + 3 ثوم',
                        startDate: '2025-01-01',
                        endDate: '2025-12-31',
                        originalPrice: 45,
                        discountPrice: 30,
                        isActive: true,
                        orderCount: 245,
                        totalRevenue: 7350,
                        avgWaitTime: 15.5,
                        satisfactionRate: 92,
                        createdAt: '2025-01-01T00:00:00Z'
                    },
                    {
                        id: 'OFF002',
                        name: 'عرض سريع 20%',
                        type: 'flash',
                        description: 'خصم 20% على جميع الطلبات',
                        startDate: '2025-01-01',
                        endDate: '2025-06-30',
                        originalPrice: 50,
                        discountPrice: 40,
                        isActive: true,
                        orderCount: 178,
                        totalRevenue: 7120,
                        avgWaitTime: 12.3,
                        satisfactionRate: 88,
                        createdAt: '2025-01-01T00:00:00Z'
                    }
                ];
            }
            
            init() {
                this.checkAuth();
                this.setupEventListeners();
                this.initCharts();
                this.loadSectionFromURL();
                this.loadOffers();
                this.loadWeeklyData();
            }
            
            checkAuth() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                
                if (isLoggedIn) {
                    this.isAuthenticated = true;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('appContainer').classList.remove('hidden');
                } else {
                    this.isAuthenticated = false;
                    document.getElementById('loginSection').classList.remove('hidden');
                    document.getElementById('appContainer').classList.add('hidden');
                }
            }
            
            login(email, password) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    document.getElementById('emailError').classList.remove('hidden');
                    document.getElementById('email').classList.add('input-error');
                    return false;
                } else {
                    document.getElementById('emailError').classList.add('hidden');
                    document.getElementById('email').classList.remove('input-error');
                }
                
                if (password.length < 6) {
                    document.getElementById('passwordError').classList.remove('hidden');
                    document.getElementById('password').classList.add('input-error');
                    return false;
                } else {
                    document.getElementById('passwordError').classList.add('hidden');
                    document.getElementById('password').classList.remove('input-error');
                }
                
                if (email && password) {
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('user', JSON.stringify({ email, name: 'أحمد كناوي' }));
                    this.isAuthenticated = true;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('appContainer').classList.remove('hidden');
                    this.showToast('تم تسجيل الدخول بنجاح', 'success');
                    return true;
                }
            }
            
            setupEventListeners() {
                // Login form
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const email = document.getElementById('email').value;
                        const password = document.getElementById('password').value;
                        this.login(email, password);
                    });
                }
                
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        this.showSection(section);
                    });
                });
                
                // Mobile menu
                document.getElementById('mobileMenuBtn')?.addEventListener('click', () => {
                    this.toggleMobileMenu();
                });
                
                // Sidebar overlay
                document.getElementById('sidebarOverlay')?.addEventListener('click', () => {
                    this.closeMobileMenu();
                });
                
                // Profile menu
                document.getElementById('profileBtn')?.addEventListener('click', () => {
                    document.getElementById('profileMenu').classList.toggle('hidden');
                });
                
                // Logout
                document.getElementById('logoutBtn')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });
                
                // Add offer
                document.getElementById('addOfferBtn')?.addEventListener('click', () => {
                    this.showSection('offers');
                    this.showTab('create-offer');
                    this.resetOfferForm();
                });
                
                // Close menus when clicking outside
                document.addEventListener('click', (e) => {
                    this.closeMenusOutside(e);
                });
                
                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.dataset.tab;
                        this.showTab(tabName);
                    });
                });
                
                // Create offer form
                const createOfferForm = document.getElementById('createOfferForm');
                if (createOfferForm) {
                    createOfferForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveOffer(e.target);
                    });
                }
                
                // Create campaign form
                const createCampaignForm = document.getElementById('createCampaignForm');
                if (createCampaignForm) {
                    createCampaignForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.createCampaign(e.target);
                    });
                }
                
                // Weekly performance form
                const weeklyPerformanceForm = document.getElementById('weeklyPerformanceForm');
                if (weeklyPerformanceForm) {
                    weeklyPerformanceForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveWeeklyPerformance(e.target);
                    });
                }
                
                // Marketing data form
                const marketingDataForm = document.getElementById('marketingDataForm');
                if (marketingDataForm) {
                    marketingDataForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveMarketingData(e.target);
                    });
                }
                
                // Customer feedback form
                const customerFeedbackForm = document.getElementById('customerFeedbackForm');
                if (customerFeedbackForm) {
                    customerFeedbackForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveCustomerFeedback(e.target);
                    });
                }
                
                // Initialize datepickers
                this.initDatePickers();
                
                // Initialize calendar
                this.initCalendar();
            }
            
            initDatePickers() {
                const datepickers = document.querySelectorAll('.datepicker');
                datepickers.forEach(el => {
                    flatpickr(el, {
                        locale: "ar",
                        dateFormat: "Y-m-d",
                        allowInput: true
                    });
                });
            }
            
            initCalendar() {
                const calendarEl = document.getElementById('calendar');
                if (calendarEl) {
                    calendarEl.innerHTML = `
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-4">
                                <button class="p-2 rounded-full hover:bg-gray-200">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <h4 class="text-lg font-semibold">يناير 2025</h4>
                                <button class="p-2 rounded-full hover:bg-gray-200">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                            <div class="grid grid-cols-7 gap-2 text-center">
                                <div class="font-semibold p-2">أحد</div>
                                <div class="font-semibold p-2">إثنين</div>
                                <div class="font-semibold p-2">ثلاثاء</div>
                                <div class="font-semibold p-2">أربعاء</div>
                                <div class="font-semibold p-2">خميس</div>
                                <div class="font-semibold p-2">جمعة</div>
                                <div class="font-semibold p-2">سبت</div>
                                
                                ${Array.from({length: 35}, (_, i) => 
                                    `<div class="p-2 border rounded ${i >= 26 && i <= 28 ? 'bg-orange-100 border-orange-300' : ''}">${i - 5 < 1 ? '' : i - 5}</div>`
                                ).join('')}
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-4 h-4 bg-orange-100 rounded mr-2"></div>
                                    <span class="text-sm">أيام بها عروض</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            toggleMobileMenu() {
                document.getElementById('sidebar').classList.toggle('open');
                document.getElementById('sidebarOverlay').classList.toggle('hidden');
            }
            
            closeMobileMenu() {
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('sidebarOverlay').classList.add('hidden');
            }
            
            logout() {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('user');
                this.isAuthenticated = false;
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('appContainer').classList.add('hidden');
                this.showToast('تم تسجيل الخروج بنجاح', 'success');
            }
            
            closeMenusOutside(e) {
                if (!e.target.closest('#profileBtn') && !e.target.closest('#profileMenu')) {
                    document.getElementById('profileMenu')?.classList.add('hidden');
                }
            }
            
            showSection(sectionName) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                const targetSection = document.getElementById(sectionName + 'Section');
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('fade-in');
                    this.currentSection = sectionName;
                    
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('bg-gray-800');
                    });
                    document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('bg-gray-800');
                    
                    this.updateURL(sectionName);
                    
                    this.lazyLoadSection(sectionName);
                }
            }
            
            lazyLoadSection(sectionName) {
                if (sectionName === 'analytics') {
                    setTimeout(() => {
                        this.initAnalyticsCharts();
                        this.renderWeeklyPerformanceTable();
                        this.showToast('تم تحميل بيانات التحليلات', 'info');
                    }, 500);
                } else if (sectionName === 'offers') {
                    this.renderOffers();
                } else if (sectionName === 'sheets') {
                    this.renderSheetsData();
                } else if (sectionName === 'dataEntry') {
                    this.renderDataEntryTables();
                }
            }
            
            updateURL(sectionName) {
                const url = new URL(window.location);
                url.searchParams.set('section', sectionName);
                window.history.pushState({}, '', url);
            }
            
            showTab(tabName) {
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName)?.classList.remove('hidden');
                
                if (tabName === 'offer-calendar') {
                    this.initCalendar();
                }
            }
            
            initCharts() {
                this.initChart('offersChart', this.chartConfigs.offers);
                this.initChart('revenueChart', this.chartConfigs.revenue);
            }
            
            initAnalyticsCharts() {
                this.initChart('weeklyPerformanceChart', this.chartConfigs.weeklyPerformance);
                this.initChart('weeklyOffersChart', this.chartConfigs.weeklyOffers);
                this.initChart('campaignPerformanceChart', this.chartConfigs.campaignPerformance);
                this.initChart('campaignROIChart', this.chartConfigs.campaignROI);
            }
            
            initChart(canvasId, config) {
                const ctx = document.getElementById(canvasId);
                if (ctx) {
                    try {
                        this.charts[canvasId] = new Chart(ctx, config);
                    } catch (error) {
                        console.error(`Error initializing chart ${canvasId}:`, error);
                        this.showToast(`Failed to initialize chart ${canvasId}`, 'error');
                    }
                }
            }
            
            loadSectionFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const section = urlParams.get('section');
                if (section) {
                    this.showSection(section);
                }
            }
            
            saveOffer(form) {
                this.showLoading(true);
                
                // Clear previous errors
                this.clearFormErrors();
                
                // Get form data
                const formData = new FormData(form);
                const offerData = {
                    name: formData.get('offerName') || document.getElementById('offerName').value,
                    type: formData.get('offerType') || document.getElementById('offerType').value,
                    description: formData.get('offerDescription') || document.getElementById('offerDescription').value,
                    startDate: formData.get('startDate') || document.getElementById('startDate').value,
                    endDate: formData.get('endDate') || document.getElementById('endDate').value,
                    originalPrice: parseFloat(formData.get('originalPrice') || document.getElementById('originalPrice').value),
                    discountPrice: parseFloat(formData.get('discountPrice') || document.getElementById('discountPrice').value),
                    isActive: document.getElementById('isActive').checked,
                    // Performance data
                    orderCount: parseInt(document.getElementById('orderCount').value) || 0,
                    totalRevenue: parseFloat(document.getElementById('totalRevenue').value) || 0,
                    avgWaitTime: parseFloat(document.getElementById('avgWaitTime').value) || 0,
                    satisfactionRate: parseInt(document.getElementById('satisfactionRate').value) || 0
                };
                
                // Validate form
                const validation = this.validateOfferForm(offerData);
                if (!validation.isValid) {
                    this.showFormErrors(validation.errors);
                    this.showLoading(false);
                    return;
                }
                
                // Check if editing or creating
                const offerId = document.getElementById('offerId').value;
                
                setTimeout(() => {
                    if (offerId) {
                        // Update existing offer
                        const index = this.offers.findIndex(o => o.id === offerId);
                        if (index !== -1) {
                            this.offers[index] = { ...this.offers[index], ...offerData };
                            this.showToast('تم تحديث العرض بنجاح', 'success');
                        }
                    } else {
                        // Create new offer
                        const newOffer = {
                            id: 'OFF' + String(this.offers.length + 1).padStart(3, '0'),
                            ...offerData,
                            createdAt: new Date().toISOString()
                        };
                        this.offers.push(newOffer);
                        this.showToast('تم إنشاء العرض بنجاح', 'success');
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('offers', JSON.stringify(this.offers));
                    
                    // Reset form and switch to list
                    this.resetOfferForm();
                    this.showTab('offers-list');
                    this.renderOffers();
                    this.updateDashboardOffers();
                    this.showLoading(false);
                }, 1000);
            }
            
            validateOfferForm(data) {
                const errors = {};
                let isValid = true;
                
                if (!data.name || data.name.trim() === '') {
                    errors.name = 'يرجى إدخال اسم العرض';
                    isValid = false;
                }
                
                if (!data.type) {
                    errors.type = 'يرجى اختيار نوع العرض';
                    isValid = false;
                }
                
                if (!data.description || data.description.trim() === '') {
                    errors.description = 'يرجى إدخال وصف العرض';
                    isValid = false;
                }
                
                if (!data.startDate) {
                    errors.startDate = 'يرجى اختيار تاريخ البدء';
                    isValid = false;
                }
                
                if (!data.endDate) {
                    errors.endDate = 'يرجى اختيار تاريخ الانتهاء';
                    isValid = false;
                }
                
                if (!data.originalPrice || data.originalPrice <= 0) {
                    errors.originalPrice = 'يرجى إدخال سعر أصلي صحيح';
                    isValid = false;
                }
                
                if (!data.discountPrice || data.discountPrice <= 0) {
                    errors.discountPrice = 'يرجى إدخال سعر الخصم صحيح';
                    isValid = false;
                }
                
                if (data.originalPrice && data.discountPrice && data.discountPrice >= data.originalPrice) {
                    errors.discountPrice = 'سعر الخصم يجب أن يكون أقل من السعر الأصلي';
                    isValid = false;
                }
                
                if (!data.orderCount || data.orderCount < 0) {
                    errors.orderCount = 'يرجى إدخال عدد الطلبات';
                    isValid = false;
                }
                
                if (!data.totalRevenue || data.totalRevenue < 0) {
                    errors.totalRevenue = 'يرجى إدخال الإيرادات';
                    isValid = false;
                }
                
                return { isValid, errors };
            }
            
            showFormErrors(errors) {
                Object.keys(errors).forEach(field => {
                    const errorElement = document.getElementById(field + 'Error');
                    const inputElement = document.getElementById(field);
                    
                    if (errorElement) {
                        errorElement.textContent = errors[field];
                        errorElement.classList.remove('hidden');
                    }
                    
                    if (inputElement) {
                        inputElement.classList.add('input-error');
                    }
                });
            }
            
            clearFormErrors() {
                const errorElements = document.querySelectorAll('.error-message');
                const inputElements = document.querySelectorAll('.input-error');
                
                errorElements.forEach(el => {
                    el.classList.add('hidden');
                    el.textContent = '';
                });
                
                inputElements.forEach(el => {
                    el.classList.remove('input-error');
                });
            }
            
            resetOfferForm() {
                document.getElementById('createOfferForm').reset();
                document.getElementById('offerId').value = '';
                document.getElementById('isActive').checked = true;
                this.clearFormErrors();
            }
            
            saveWeeklyPerformance(form) {
                this.showLoading(true);
                
                const weeklyData = {
                    week: parseInt(document.getElementById('weekNumber').value),
                    month: parseInt(document.getElementById('monthNumber').value),
                    mainOffer: document.getElementById('mainOffer').value,
                    orders: parseInt(document.getElementById('weeklyOrders').value),
                    revenue: parseFloat(document.getElementById('weeklyRevenue').value),
                    waitTime: parseFloat(document.getElementById('weeklyWaitTime').value) || 0,
                    satisfaction: parseInt(document.getElementById('weeklySatisfaction').value) || 0,
                    complaints: parseInt(document.getElementById('weeklyComplaints').value) || 0,
                    notes: document.getElementById('weeklyNotes').value,
                    date: new Date().toISOString()
                };
                
                setTimeout(() => {
                    this.weeklyData.push(weeklyData);
                    localStorage.setItem('weeklyData', JSON.stringify(this.weeklyData));
                    
                    this.resetWeeklyForm();
                    this.showToast('تم حفظ بيانات الأداء الأسبوعي بنجاح', 'success');
                    this.showLoading(false);
                    
                    // Update analytics if on analytics section
                    if (this.currentSection === 'analytics') {
                        this.updateAnalytics();
                    }
                }, 1000);
            }
            
            saveMarketingData(form) {
                this.showLoading(true);
                
                const marketingEntry = {
                    campaign: document.getElementById('marketingCampaign').value,
                    date: document.getElementById('marketingDate').value,
                    reach: parseInt(document.getElementById('marketingReach').value),
                    engagement: parseInt(document.getElementById('marketingEngagement').value),
                    conversions: parseInt(document.getElementById('marketingConversions').value),
                    cost: parseFloat(document.getElementById('marketingCost').value),
                    notes: document.getElementById('marketingNotes').value,
                    timestamp: new Date().toISOString()
                };
                
                setTimeout(() => {
                    this.marketingData.push(marketingEntry);
                    localStorage.setItem('marketingData', JSON.stringify(this.marketingData));
                    
                    this.resetMarketingForm();
                    this.showToast('تم حفظ بيانات التسويق بنجاح', 'success');
                    this.showLoading(false);
                }, 1000);
            }
            
            saveCustomerFeedback(form) {
                this.showLoading(true);
                
                const feedback = {
                    date: document.getElementById('feedbackDate').value,
                    type: document.getElementById('feedbackType').value,
                    rating: parseInt(document.getElementById('feedbackRating').value) || 0,
                    department: document.getElementById('feedbackDepartment').value,
                    text: document.getElementById('feedbackText').value,
                    actions: document.getElementById('feedbackActions').value,
                    timestamp: new Date().toISOString()
                };
                
                setTimeout(() => {
                    this.customerFeedback.push(feedback);
                    localStorage.setItem('customerFeedback', JSON.stringify(this.customerFeedback));
                    
                    this.resetFeedbackForm();
                    this.showToast('تم حفظ ملاحظة العميل بنجاح', 'success');
                    this.showLoading(false);
                }, 1000);
            }
            
            resetWeeklyForm() {
                document.getElementById('weeklyPerformanceForm').reset();
            }
            
            resetMarketingForm() {
                document.getElementById('marketingDataForm').reset();
            }
            
            resetFeedbackForm() {
                document.getElementById('customerFeedbackForm').reset();
            }
            
            editOffer(offerId) {
                const offer = this.offers.find(o => o.id === offerId);
                if (offer) {
                    this.showSection('offers');
                    this.showTab('create-offer');
                    
                    // Populate form
                    document.getElementById('offerId').value = offer.id;
                    document.getElementById('offerName').value = offer.name;
                    document.getElementById('offerType').value = offer.type;
                    document.getElementById('offerDescription').value = offer.description;
                    document.getElementById('startDate').value = offer.startDate;
                    document.getElementById('endDate').value = offer.endDate;
                    document.getElementById('originalPrice').value = offer.originalPrice;
                    document.getElementById('discountPrice').value = offer.discountPrice;
                    document.getElementById('isActive').checked = offer.isActive;
                    
                    // Performance data
                    document.getElementById('orderCount').value = offer.orderCount || 0;
                    document.getElementById('totalRevenue').value = offer.totalRevenue || 0;
                    document.getElementById('avgWaitTime').value = offer.avgWaitTime || 0;
                    document.getElementById('satisfactionRate').value = offer.satisfactionRate || 0;
                    
                    // Re-initialize datepickers
                    this.initDatePickers();
                    
                    this.showToast('جاري تحرير العرض', 'info');
                }
            }
            
            deleteOffer(offerId) {
                this.deleteOfferId = offerId;
                document.getElementById('deleteModal').classList.remove('hidden');
            }
            
            closeDeleteModal() {
                document.getElementById('deleteModal').classList.add('hidden');
                this.deleteOfferId = null;
            }
            
            confirmDelete() {
                if (this.deleteOfferId) {
                    this.showLoading(true);
                    
                    setTimeout(() => {
                        this.offers = this.offers.filter(o => o.id !== this.deleteOfferId);
                        localStorage.setItem('offers', JSON.stringify(this.offers));
                        
                        this.renderOffers();
                        this.updateDashboardOffers();
                        this.closeDeleteModal();
                        this.showLoading(false);
                        this.showToast('تم حذف العرض بنجاح', 'success');
                    }, 1000);
                }
            }
            
            createCampaign(form) {
                this.showToast('جاري حفظ الحملة...', 'info');
                
                setTimeout(() => {
                    this.showToast('تم حفظ الحملة بنجاح', 'success');
                    form.reset();
                    this.showTab('campaigns-list');
                }, 1500);
            }
            
            loadOffers() {
                this.renderOffers();
                this.updateDashboardOffers();
            }
            
            loadWeeklyData() {
                this.renderWeeklyPerformanceTable();
            }
            
            renderOffers() {
                const grid = document.getElementById('offersGrid');
                if (!grid) return;
                
                const filteredOffers = this.getFilteredOffers();
                
                grid.innerHTML = filteredOffers.map(offer => `
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between mb-4">
                            <span class="badge-${offer.type} px-3 py-1 rounded text-sm">${this.getTypeLabel(offer.type)}</span>
                            <span class="badge-${offer.isActive ? 'active' : 'inactive'} px-3 py-1 rounded text-sm">${offer.isActive ? 'نشط' : 'منتهي'}</span>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">${offer.name}</h3>
                        <p class="text-gray-600 mb-4">${offer.description}</p>
                        <div class="flex justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500">السعر الأصلي</p>
                                <p class="text-lg font-bold text-gray-400 line-through">${offer.originalPrice.toFixed(2)} درهم</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">السعر بعد الخصم</p>
                                <p class="text-2xl font-bold text-orange-600">${offer.discountPrice.toFixed(2)} درهم</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-4 text-sm">
                            <div>
                                <p class="text-gray-500">الطلبات: ${offer.orderCount || 0}</p>
                                <p class="text-gray-500">الإيرادات: $${(offer.totalRevenue || 0).toFixed(2)}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">الانتظار: ${offer.avgWaitTime || 0} دقيقة</p>
                                <p class="text-gray-500">الرضا: ${offer.satisfactionRate || 0}%</p>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm mb-4">
                            <div>
                                <p class="text-gray-500">المدة: ${this.formatDateRange(offer.startDate, offer.endDate)}</p>
                            </div>
                            <div>
                                <p class="${offer.isActive ? 'text-green-600' : 'text-red-600'} font-medium">${offer.isActive ? 'نشط' : 'منتهي'}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="app.editOffer('${offer.id}')" class="flex-1 px-3 py-2 bg-orange-100 text-orange-700 rounded hover:bg-orange-200">
                                <i class="fas fa-edit ml-1"></i>تعديل
                            </button>
                            <button onclick="app.viewAnalytics('${offer.id}')" class="flex-1 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                                <i class="fas fa-chart-bar ml-1"></i>تحليل
                            </button>
                            <button onclick="app.deleteOffer('${offer.id}')" class="px-3 py-2 bg-red-100 text-red-700 rounded hover:bg-red-200">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            getFilteredOffers() {
                const typeFilter = document.getElementById('filterType')?.value || '';
                const statusFilter = document.getElementById('filterStatus')?.value || '';
                
                return this.offers.filter(offer => {
                    const typeMatch = !typeFilter || offer.type === typeFilter;
                    const statusMatch = !statusFilter || 
                        (statusFilter === 'active' && offer.isActive) ||
                        (statusFilter === 'inactive' && !offer.isActive);
                    
                    return typeMatch && statusMatch;
                });
            }
            
            applyFilters() {
                this.renderOffers();
                this.showToast('تم تطبيق الفلاتر', 'info');
            }
            
            updateAnalytics() {
                // Update weekly performance chart
                if (this.charts.weeklyPerformanceChart) {
                    const weeklyOrders = this.weeklyData.map(d => d.orders);
                    const weeklyRevenue = this.weeklyData.map(d => d.revenue);
                    
                    this.charts.weeklyPerformanceChart.data.datasets[0].data = weeklyOrders;
                    this.charts.weeklyPerformanceChart.data.datasets[1].data = weeklyRevenue;
                    this.charts.weeklyPerformanceChart.update();
                }
                
                this.renderWeeklyPerformanceTable();
            }
            
            renderWeeklyPerformanceTable() {
                const tbody = document.getElementById('weeklyPerformanceTable');
                if (!tbody) return;
                
                tbody.innerHTML = this.weeklyData.map(data => {
                    const previousWeek = this.weeklyData.find(d => 
                        d.month === data.month && d.week === data.week - 1
                    );
                    const comparison = previousWeek ? 
                        ((data.orders - previousWeek.orders) / previousWeek.orders * 100).toFixed(1) : 
                        '0';
                    
                    return `
                        <tr class="border-b">
                            <td class="p-2">الأسبوع ${data.week}</td>
                            <td class="p-2">${this.getOfferLabel(data.mainOffer)}</td>
                            <td class="p-2">${data.orders}</td>
                            <td class="p-2">$${data.revenue.toFixed(2)}</td>
                            <td class="p-2">
                                <span class="${comparison > 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${comparison > 0 ? '+' : ''}${comparison}%
                                </span>
                            </td>
                            <td class="p-2">${data.notes || '-'}</td>
                        </tr>
                    `;
                }).join('');
            }
            
            renderSheetsData() {
                // Offers data table
                const offersTbody = document.getElementById('offersDataTable');
                if (offersTbody) {
                    offersTbody.innerHTML = this.offers.map(offer => `
                        <tr class="border-b">
                            <td class="p-2">${offer.id}</td>
                            <td class="p-2">${offer.name}</td>
                            <td class="p-2"><span class="badge-${offer.type} px-2 py-1 rounded text-sm">${this.getTypeLabel(offer.type)}</span></td>
                            <td class="p-2">${offer.orderCount || 0}</td>
                            <td class="p-2">$${(offer.totalRevenue || 0).toFixed(2)}</td>
                            <td class="p-2">${offer.avgWaitTime || 0} دقيقة</td>
                            <td class="p-2">${offer.satisfactionRate || 0}%</td>
                            <td class="p-2"><span class="badge-${offer.isActive ? 'active' : 'inactive'} px-2 py-1 rounded text-sm">${offer.isActive ? 'نشط' : 'منتهي'}</span></td>
                        </tr>
                    `).join('');
                }
                
                // Weekly data table
                const weeklyTbody = document.getElementById('weeklyDataTable');
                if (weeklyTbody) {
                    weeklyTbody.innerHTML = this.weeklyData.map(data => {
                        const previousWeek = this.weeklyData.find(d => 
                            d.month === data.month && d.week === data.week - 1
                        );
                        const comparison = previousWeek ? 
                            ((data.orders - previousWeek.orders) / previousWeek.orders * 100).toFixed(1) : 
                            '0';
                        
                        return `
                            <tr class="border-b">
                                <td class="p-2">الأسبوع ${data.week}</td>
                                <td class="p-2">${this.getOfferLabel(data.mainOffer)}</td>
                                <td class="p-2">${data.orders}</td>
                                <td class="p-2">$${data.revenue.toFixed(2)}</td>
                                <td class="p-2">
                                    <span class="${comparison > 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${comparison > 0 ? '+' : ''}${comparison}%
                                    </span>
                                </td>
                                <td class="p-2">${data.notes || '-'}</td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Campaign data table
                const campaignTbody = document.getElementById('campaignDataTable');
                if (campaignTbody) {
                    campaignTbody.innerHTML = this.marketingData.map(data => {
                        const roi = data.cost > 0 ? 
                            ((data.conversions * 25) / data.cost * 100).toFixed(1) : 
                            '0';
                        
                        return `
                            <tr class="border-b">
                                <td class="p-2">${this.getCampaignLabel(data.campaign)}</td>
                                <td class="p-2">${data.date}</td>
                                <td class="p-2">${data.reach}</td>
                                <td class="p-2">${data.conversions}</td>
                                <td class="p-2">$${data.cost.toFixed(2)}</td>
                                <td class="p-2">${roi}%</td>
                                <td class="p-2"><span class="badge-active px-2 py-1 rounded text-sm">نشط</span></td>
                            </tr>
                        `;
                    }).join('');
                }
            }
            
            renderDataEntryTables() {
                // This method can be used to display summary tables in the data entry section
            }
            
            updateDashboardOffers() {
                const tbody = document.getElementById('dashboardOffersTable');
                if (!tbody) return;
                
                const activeOffers = this.offers.filter(o => o.isActive);
                
                tbody.innerHTML = activeOffers.slice(0, 5).map(offer => `
                    <tr class="border-b">
                        <td class="p-2">${offer.name}</td>
                        <td class="p-2"><span class="badge-${offer.type} px-2 py-1 rounded text-sm">${this.getTypeLabel(offer.type)}</span></td>
                        <td class="p-2"><span class="badge-active px-2 py-1 rounded text-sm">نشط</span></td>
                        <td class="p-2">
                            <button class="text-blue-600 hover:text-blue-800 ml-2" onclick="app.editOffer('${offer.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-800" onclick="app.viewAnalytics('${offer.id}')">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
            
            getTypeLabel(type) {
                const labels = {
                    fixed: 'ثابت',
                    flash: 'محدود',
                    value: 'قيمة مضافة'
                };
                return labels[type] || type;
            }
            
            getOfferLabel(offer) {
                const labels = {
                    '12-piece': '12 قطعة',
                    '8-piece': '8 قطع',
                    'family': 'وجبة عائلية',
                    'none': 'لا يوجد عرض'
                };
                return labels[offer] || offer;
            }
            
            getCampaignLabel(campaign) {
                const labels = {
                    'social': 'وسائل التواصل',
                    'email': 'بريد إلكتروني',
                    'sms': 'رسائل نصية',
                    'ads': 'إعلانات'
                };
                return labels[campaign] || campaign;
            }
            
            formatDateRange(start, end) {
                const startDate = new Date(start);
                const endDate = new Date(end);
                
                if (startDate.toDateString() === endDate.toDateString()) {
                    return 'يوم واحد';
                }
                
                const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                if (days <= 7) {
                    return `${days} أيام`;
                }
                
                const weeks = Math.ceil(days / 7);
                if (weeks <= 4) {
                    return `${weeks} أسابيع`;
                }
                
                const months = Math.ceil(days / 30);
                return `${months} أشهر`;
            }
            
            viewAnalytics(offerId) {
                this.showToast(`عرض تحليلات العرض: ${offerId}`, 'info');
                this.showSection('analytics');
            }
            
            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                if (show) {
                    overlay.classList.remove('hidden');
                } else {
                    overlay.classList.add('hidden');
                }
            }
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.getElementById('toastContainer').appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            app = new App();
        });
        
        window.addEventListener('popstate', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            if (section) {
                app.showSection(section);
            }
        });
    </script>
</body>
</html>
