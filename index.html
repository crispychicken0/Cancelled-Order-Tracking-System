<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة العروض - Crispy Chicken</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #f44336;
            --info-color: #2196F3;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.15);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        header p {
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        /* Top Navigation */
        .top-nav {
            background: var(--white);
            padding: 15px 30px;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }
        
        .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .nav-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .notification-bell:hover {
            background: var(--light-bg);
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger-color);
            color: var(--white);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }
        
        .user-menu:hover {
            background: var(--light-bg);
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            right: -280px;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--white);
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.active {
            right: 0;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            text-align: center;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: var(--light-bg);
            border-right-color: var(--primary-color);
        }
        
        .menu-item.active {
            background: var(--light-bg);
            border-right-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .menu-item i {
            margin-left: 15px;
            width: 20px;
            text-align: center;
        }
        
        .menu-item .badge {
            margin-right: auto;
            background: var(--danger-color);
            color: var(--white);
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .breadcrumb-item {
            color: var(--text-secondary);
        }
        
        .breadcrumb-item:not(:last-child)::after {
            content: '/';
            margin: 0 10px;
            color: var(--border-color);
        }
        
        .breadcrumb-item.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
        }
        
        .tab:hover {
            color: var(--primary-color);
        }
        
        .tab.active {
            color: var(--primary-color);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            left: 0;
            height: 3px;
            background: var(--primary-color);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { width: 0; }
            to { width: 100%; }
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            padding: 25px;
            margin-bottom: 30px;
            transition: var(--transition);
            border-right: 4px solid var(--primary-color);
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .card-actions button {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-warning {
            background: var(--warning-color);
        }
        
        .btn-danger {
            background: var(--danger-color);
        }
        
        .btn-icon {
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .data-table th, .data-table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--text-primary);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .data-table .actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .data-table .actions button {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        /* KPI Cards */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 10s ease-in-out infinite;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .kpi-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        
        .kpi-card h3 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .kpi-card p {
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .kpi-trend {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .kpi-trend.up {
            color: #4CAF50;
        }
        
        .kpi-trend.down {
            color: #f44336;
        }
        
        /* Charts */
        .chart-container {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
            transition: var(--transition);
        }
        
        .chart-container:hover {
            box-shadow: var(--shadow-md);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-actions {
            display: flex;
            gap: 10px;
        }
        
        .chart-actions button {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-active {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-pending {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        /* Filters */
        .filter-section {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        /* Offer Cards */
        .offers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .offer-card {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border-right: 4px solid var(--primary-color);
        }
        
        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .offer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .offer-status {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1;
        }
        
        .offer-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .offer-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .offer-code {
            background: var(--primary-color);
            color: var(--white);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .offer-details {
            margin-bottom: 15px;
        }
        
        .offer-details p {
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .offer-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .offer-stat {
            background: var(--light-bg);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .offer-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .offer-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .offer-actions {
            display: flex;
            gap: 10px;
        }
        
        .offer-actions button {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
        }
        
        /* Platform Cards */
        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .platform-chip {
            background: var(--light-bg);
            border-radius: 25px;
            padding: 10px 20px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .platform-chip:hover {
            background: #e0e0e0;
        }
        
        .platform-chip.selected {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }
        
        .platform-chip i {
            font-size: 1.2rem;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--white);
            color: var(--text-primary);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            transform: translateX(-400px);
            transition: var(--transition);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-right: 4px solid var(--success-color);
        }
        
        .notification.error {
            border-right: 4px solid var(--danger-color);
        }
        
        .notification.warning {
            border-right: 4px solid var(--warning-color);
        }
        
        .notification.info {
            border-right: 4px solid var(--info-color);
        }
        
        .notification-icon {
            font-size: 1.5rem;
        }
        
        .notification.success .notification-icon {
            color: var(--success-color);
        }
        
        .notification.error .notification-icon {
            color: var(--danger-color);
        }
        
        .notification.warning .notification-icon {
            color: var(--warning-color);
        }
        
        .notification.info .notification-icon {
            color: var(--info-color);
        }
        
        .notification-close {
            margin-right: auto;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .notification-close:hover {
            color: var(--text-primary);
        }
        
        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: var(--danger-color);
            color: var(--white);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            transform: rotate(90deg);
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                margin: 10px;
            }
            
            .kpi-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .top-nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-bar {
                max-width: 100%;
            }
            
            .sidebar {
                width: 100%;
                right: -100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .offers-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .kpi-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                padding: 15px;
            }
            
            .data-table {
                font-size: 0.9rem;
            }
            
            .data-table th, .data-table td {
                padding: 10px;
            }
            
            .platforms-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .modal-content {
                padding: 20px;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }
            
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .notification {
                right: 10px;
                left: auto;
                transform: translateY(-100px);
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus styles */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        
        /* Skip to main content */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-color);
            color: var(--white);
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-bg: #2d3748;
                --white: #1a202c;
                --text-primary: #e2e8f0;
                --text-secondary: #a0aec0;
                --border-color: #4a5568;
            }
            
            .card {
                background: var(--white);
            }
            
            .data-table th {
                background: var(--light-bg);
            }
            
            .search-bar input,
            input,
            select,
            textarea {
                background: var(--white);
                color: var(--text-primary);
                border-color: var(--border-color);
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">تخطي إلى المحتوى الرئيسي</a>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-drumstick-bite"></i> نظام إدارة العروض - Crispy Chicken</h1>
            <p>إدارة وتحليل العروض والمبيعات والفروع والمنصات</p>
        </header>
        
        <nav class="top-nav">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="ابحث في النظام..." id="globalSearch">
            </div>
            <div class="nav-actions">
                <div class="notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
                <div class="user-menu">
                    <div class="user-avatar">م</div>
                    <span>مدير النظام</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <button class="btn btn-icon" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>
        
        <div class="main-content">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>القائمة الرئيسية</h3>
                </div>
                <div class="sidebar-menu">
                    <div class="menu-item active" onclick="showTab('offers')">
                        <i class="fas fa-tags"></i>
                        <span>إدارة العروض</span>
                    </div>
                    <div class="menu-item" onclick="showTab('sales')">
                        <i class="fas fa-chart-line"></i>
                        <span>تسجيل المبيعات</span>
                    </div>
                    <div class="menu-item" onclick="showTab('branches')">
                        <i class="fas fa-store"></i>
                        <span>إدارة الفروع</span>
                    </div>
                    <div class="menu-item" onclick="showTab('platforms')">
                        <i class="fas fa-globe"></i>
                        <span>إدارة المنصات</span>
                    </div>
                    <div class="menu-item" onclick="showTab('pastOffers')">
                        <i class="fas fa-history"></i>
                        <span>العروض السابقة</span>
                        <span class="badge">9</span>
                    </div>
                    <div class="menu-item" onclick="showTab('analysis')">
                        <i class="fas fa-analytics"></i>
                        <span>التحليلات</span>
                    </div>
                    <div class="menu-item" onclick="showTab('reports')">
                        <i class="fas fa-file-alt"></i>
                        <span>التقارير</span>
                    </div>
                    <div class="menu-item" onclick="showTab('settings')">
                        <i class="fas fa-cog"></i>
                        <span>الإعدادات</span>
                    </div>
                </div>
            </aside>
            
            <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
            
            <main class="content-area" id="main-content">
                <div class="breadcrumb">
                    <span class="breadcrumb-item">الرئيسية</span>
                    <span class="breadcrumb-item active" id="breadcrumbCurrent">إدارة العروض</span>
                </div>
                
                <div class="filter-section">
                    <div class="filter-header">
                        <h3><i class="fas fa-filter"></i> فلاتر البحث والتحليل</h3>
                        <button class="btn btn-sm btn-outline" onclick="resetFilters()">
                            <i class="fas fa-redo"></i> إعادة تعيين
                        </button>
                    </div>
                    <div class="filter-controls">
                        <div class="form-group">
                            <label>الفرع</label>
                            <select id="branchFilter">
                                <option value="">جميع الفروع</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>المنصة</label>
                            <select id="platformFilter">
                                <option value="">جميع المنصات</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>العرض</label>
                            <select id="offerFilter">
                                <option value="">جميع العروض</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>من تاريخ</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div class="form-group">
                            <label>إلى تاريخ</label>
                            <input type="date" id="dateTo">
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="applyFilters()">
                                <i class="fas fa-search"></i> تطبيق الفلاتر
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab active" onclick="showTab('offers')">
                        <i class="fas fa-tags"></i> إدارة العروض
                    </button>
                    <button class="tab" onclick="showTab('sales')">
                        <i class="fas fa-chart-line"></i> تسجيل المبيعات
                    </button>
                    <button class="tab" onclick="showTab('branches')">
                        <i class="fas fa-store"></i> إدارة الفروع
                    </button>
                    <button class="tab" onclick="showTab('platforms')">
                        <i class="fas fa-globe"></i> إدارة المنصات
                    </button>
                    <button class="tab" onclick="showTab('pastOffers')">
                        <i class="fas fa-history"></i> العروض السابقة
                    </button>
                    <button class="tab" onclick="showTab('analysis')">
                        <i class="fas fa-analytics"></i> التحليلات
                    </button>
                </div>
                
                <!-- إدارة العروض -->
                <div id="offers" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-plus-circle"></i> إضافة عرض جديد
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="importOffers()">
                                    <i class="fas fa-file-import"></i> استيراد
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="exportOffers()">
                                    <i class="fas fa-file-export"></i> تصدير
                                </button>
                            </div>
                        </div>
                        <form id="offerForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>اسم العرض <span class="text-danger">*</span></label>
                                    <input type="text" id="offerName" required>
                                </div>
                                <div class="form-group">
                                    <label>رمز العرض <span class="text-danger">*</span></label>
                                    <input type="text" id="offerCode" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>تاريخ البدء <span class="text-danger">*</span></label>
                                    <input type="date" id="startDate" required>
                                </div>
                                <div class="form-group">
                                    <label>تاريخ الانتهاء <span class="text-danger">*</span></label>
                                    <input type="date" id="endDate" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>المنتجات المشمولة <span class="text-danger">*</span></label>
                                <textarea id="products" rows="3" required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>السعر العادي (درهم) <span class="text-danger">*</span></label>
                                    <input type="number" id="regularPrice" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>سعر العرض (درهم) <span class="text-danger">*</span></label>
                                    <input type="number" id="offerPrice" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>التكلفة التقديرية (درهم) <span class="text-danger">*</span></label>
                                    <input type="number" id="estimatedCost" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label>الحد الأقصى للطلبات</label>
                                    <input type="number" id="maxOrders" min="0">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ملاحظات إضافية</label>
                                <textarea id="offerNotes" rows="2"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn">
                                    <i class="fas fa-save"></i> حفظ العرض
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm('offerForm')">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-list"></i> قائمة العروض النشطة
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="duplicateSelectedOffer()">
                                    <i class="fas fa-copy"></i> نسخ
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="archiveSelectedOffers()">
                                    <i class="fas fa-archive"></i> أرشفة
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteSelectedOffers()">
                                    <i class="fas fa-trash"></i> حذف
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="offersTable">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="selectAllOffers" onchange="toggleSelectAll('offers')">
                                        </th>
                                        <th>اسم العرض</th>
                                        <th>رمز العرض</th>
                                        <th>الخصم</th>
                                        <th>السعر</th>
                                        <th>الربح</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها بواسطة JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- تسجيل المبيعات -->
                <div id="sales" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-plus-circle"></i> تسجيل مبيعات جديدة
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="bulkSalesEntry()">
                                    <i class="fas fa-layer-group"></i> إدخال جماعي
                                </button>
                            </div>
                        </div>
                        <form id="salesForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>الفرع <span class="text-danger">*</span></label>
                                    <select id="branchName" required>
                                        <option value="">اختر الفرع</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>المنصة <span class="text-danger">*</span></label>
                                    <select id="platformName" required>
                                        <option value="">اختر المنصة</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>العرض <span class="text-danger">*</span></label>
                                    <select id="salesOffer" required>
                                        <option value="">اختر العرض</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>الأسبوع <span class="text-danger">*</span></label>
                                    <input type="number" id="weekNumber" min="1" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>عدد الطلبات <span class="text-danger">*</span></label>
                                    <input type="number" id="orderCount" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label>التكلفة الفعلية (درهم) <span class="text-danger">*</span></label>
                                    <input type="number" id="actualCost" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ملاحظات</label>
                                <textarea id="salesNotes" rows="2"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn">
                                    <i class="fas fa-save"></i> تسجيل المبيعات
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm('salesForm')">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-line"></i> سجل المبيعات
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="exportSalesData()">
                                    <i class="fas fa-download"></i> تصدير البيانات
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="salesTable">
                                <thead>
                                    <tr>
                                        <th>الفرع</th>
                                        <th>المنصة</th>
                                        <th>العرض</th>
                                        <th>الأسبوع</th>
                                        <th>الطلبات</th>
                                        <th>الإيرادات</th>
                                        <th>الربح</th>
                                        <th>النمو%</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها بواسطة JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- إدارة الفروع -->
                <div id="branches" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-plus-circle"></i> إضافة فرع جديد
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="importBranches()">
                                    <i class="fas fa-file-import"></i> استيراد من Excel
                                </button>
                            </div>
                        </div>
                        <form id="branchForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>اسم الفرع <span class="text-danger">*</span></label>
                                    <input type="text" id="branchNameInput" required>
                                </div>
                                <div class="form-group">
                                    <label>المدينة <span class="text-danger">*</span></label>
                                    <select id="branchCity" required>
                                        <option value="">اختر المدينة</option>
                                        <option value="Abu Dhabi">أبوظبي</option>
                                        <option value="Dubai">دبي</option>
                                        <option value="Sharjah">الشارقة</option>
                                        <option value="Ajman">عجمان</option>
                                        <option value="Umm Al Quwain">أم القيوين</option>
                                        <option value="Ras Al Khaimah">رأس الخيمة</option>
                                        <option value="Fujairah">الفجيرة</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>الإحداثيات</label>
                                    <input type="text" id="branchDirection" placeholder="مثال: 24.4958298421285, 54.37155779999593">
                                </div>
                                <div class="form-group">
                                    <label>المنطقة <span class="text-danger">*</span></label>
                                    <input type="text" id="branchArea" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>رقم الهاتف الأرضي</label>
                                    <input type="tel" id="branchLandline" placeholder="مثال: (02) 641 1194">
                                </div>
                                <div class="form-group">
                                    <label>رابط جوجل</label>
                                    <input type="url" id="branchGoogleSite" placeholder="مثال: https://g.co/kgs/TrxJBJV">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>التقييم</label>
                                    <input type="number" id="branchRate" min="0" max="5" step="0.1" placeholder="مثال: 4.5">
                                </div>
                                <div class="form-group">
                                    <label>اسم المدير <span class="text-danger">*</span></label>
                                    <input type="text" id="branchManager" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>رقم المدير</label>
                                    <input type="tel" id="branchManagerNumber" placeholder="مثال: 971 55 688 6650">
                                </div>
                                <div class="form-group">
                                    <label>البريد الإلكتروني</label>
                                    <input type="email" id="branchEmail" placeholder="مثال: crispychickenhamdan@gmail.com">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>حالة التوصيل <span class="text-danger">*</span></label>
                                    <select id="branchDeliveryStatus" required>
                                        <option value="">اختر الحالة</option>
                                        <option value="Yes">متاح</option>
                                        <option value="No">غير متاح</option>
                                        <option value="N/A">غير متوفر</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>رابط الفرع الإلكتروني</label>
                                    <input type="url" id="branchLinkOnline" placeholder="مثال: http://almarkaziya.crispychicken-uae.com/#_branch94929">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn">
                                    <i class="fas fa-save"></i> حفظ الفرع
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm('branchForm')">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-store"></i> قائمة الفروع
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="showBranchesMap()">
                                    <i class="fas fa-map-marked-alt"></i> عرض على الخريطة
                                </button>
                            </div>
                        </div>
                        <div id="branchesList" class="branches-grid">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- إدارة المنصات -->
                <div id="platforms" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-plus-circle"></i> إضافة منصة جديدة
                            </h2>
                        </div>
                        <form id="platformForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>اسم المنصة <span class="text-danger">*</span></label>
                                    <select id="platformType" required>
                                        <option value="">اختر المنصة</option>
                                        <option value="self_delivery">Self Delivery</option>
                                        <option value="online">Online</option>
                                        <option value="deliveroo">Deliveroo</option>
                                        <option value="talabat">Talabat</option>
                                        <option value="smile">Smile</option>
                                        <option value="noon">Noon</option>
                                        <option value="careem">Careem</option>
                                        <option value="other">أخرى</option>
                                    </select>
                                </div>
                                <div class="form-group" id="customPlatformName" style="display: none;">
                                    <label>اسم المنصة (أخرى)</label>
                                    <input type="text" id="customPlatformNameInput">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>رابط المنصة</label>
                                    <input type="url" id="platformUrl" placeholder="مثال: https://example.com">
                                </div>
                                <div class="form-group">
                                    <label>معدل العمولة (%)</label>
                                    <input type="number" id="platformCommission" min="0" max="100" step="0.1" placeholder="مثال: 15">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>حالة المنصة <span class="text-danger">*</span></label>
                                    <select id="platformStatus" required>
                                        <option value="active">نشطة</option>
                                        <option value="inactive">غير نشطة</option>
                                        <option value="maintenance">صيانة</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>الأولوية</label>
                                    <select id="platformPriority">
                                        <option value="high">عالية</option>
                                        <option value="medium">متوسطة</option>
                                        <option value="low">منخفضة</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ملاحظات</label>
                                <textarea id="platformNotes" rows="2"></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn">
                                    <i class="fas fa-save"></i> حفظ المنصة
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm('platformForm')">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-globe"></i> قائمة المنصات
                            </h2>
                        </div>
                        <div id="platformsList" class="platforms-cards">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- العروض السابقة -->
                <div id="pastOffers" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-plus-circle"></i> إضافة عرض سابق
                            </h2>
                        </div>
                        <form id="pastOfferForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>من تاريخ <span class="text-danger">*</span></label>
                                    <input type="date" id="pastOfferStartDate" required>
                                </div>
                                <div class="form-group">
                                    <label>إلى تاريخ <span class="text-danger">*</span></label>
                                    <input type="date" id="pastOfferEndDate" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>تفاصيل العرض <span class="text-danger">*</span></label>
                                <textarea id="pastOfferDetails" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>المنصات المتاحة <span class="text-danger">*</span></label>
                                <div class="platforms-grid" id="platformsGrid">
                                    <!-- سيتم ملؤها بواسطة JavaScript -->
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn">
                                    <i class="fas fa-save"></i> إضافة العرض السابق
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm('pastOfferForm')">
                                    <i class="fas fa-times"></i> إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-history"></i> العروض السابقة
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-outline" onclick="exportPastOffers()">
                                    <i class="fas fa-download"></i> تصدير التقرير
                                </button>
                            </div>
                        </div>
                        <div class="search-box">
                            <input type="text" id="searchPastOffers" placeholder="ابحث عن عرض باسمه أو رمزه..." onkeyup="searchPastOffers()">
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="pastOffersTable">
                                <thead>
                                    <tr>
                                        <th>نطاق التاريخ</th>
                                        <th>تفاصيل العرض</th>
                                        <th>المنصات المتاحة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- سيتم ملؤها بواسطة JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- التحليلات -->
                <div id="analysis" class="tab-content">
                    <div class="kpi-container">
                        <div class="kpi-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i> 12.5%
                            </div>
                            <h3 id="totalRevenue">0</h3>
                            <p>إجمالي الإيرادات (درهم)</p>
                        </div>
                        <div class="kpi-card">
                            <i class="fas fa-chart-pie"></i>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i> 8.3%
                            </div>
                            <h3 id="totalProfit">0</h3>
                            <p>إجمالي الأرباح (درهم)</p>
                        </div>
                        <div class="kpi-card">
                            <i class="fas fa-shopping-cart"></i>
                            <div class="kpi-trend down">
                                <i class="fas fa-arrow-down"></i> 3.2%
                            </div>
                            <h3 id="avgOrderValue">0</h3>
                            <p>متوسط قيمة الطلب (درهم)</p>
                        </div>
                        <div class="kpi-card">
                            <i class="fas fa-users"></i>
                            <div class="kpi-trend up">
                                <i class="fas fa-arrow-up"></i> 15.7%
                            </div>
                            <h3 id="totalOrders">0</h3>
                            <p>إجمالي الطلبات</p>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">اتجاهات المبيعات الأسبوعية</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-outline" onclick="downloadChart('salesTrendChart')">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="toggleChartType('salesTrendChart')">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="salesTrendChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">مقارنة أداء الفروع</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-outline" onclick="downloadChart('branchComparisonChart')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="branchComparisonChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">تحليل ربحية العروض</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-outline" onclick="downloadChart('offerProfitabilityChart')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="offerProfitabilityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">أداء المنصات</h3>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-outline" onclick="downloadChart('platformPerformanceChart')">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="platformPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal for offer details -->
    <div id="offerDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">تفاصيل العرض</h2>
                <button class="modal-close" onclick="closeModal('offerDetailsModal')">×</button>
            </div>
            <div id="offerDetailsContent">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Modal for branch details -->
    <div id="branchDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">تفاصيل الفرع</h2>
                <button class="modal-close" onclick="closeModal('branchDetailsModal')">×</button>
            </div>
            <div id="branchDetailsContent">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Notifications container -->
    <div id="notificationContainer"></div>
    
    <script>
        // نظام إدارة العروض وتحليل المبيعات
        let offers = JSON.parse(localStorage.getItem('crispyOffers')) || [];
        let sales = JSON.parse(localStorage.getItem('crispySales')) || [];
        let branches = JSON.parse(localStorage.getItem('crispyBranches')) || [
            {
                id: 1,
                name: 'Crispy Chicken-Hamdan St',
                city: 'Abu Dhabi',
                direction: '24.4958298421285, 54.37155779999593',
                area: 'Hamdan Opposite Sun and San Sports',
                landline: '(02) 641 1194',
                googleSite: 'https://g.co/kgs/TrxJBJV',
                rate: 4,
                manager: 'Mr. Mahmoud',
                managerNumber: '971 55 688 6650',
                email: 'crispychickenhamdan@gmail.com',
                deliveryStatus: 'Yes',
                linkOnline: 'http://almarkaziya.crispychicken-uae.com/#_branch94929',
                createdAt: new Date().toISOString()
            },
            {
                id: 2,
                name: 'Crispy chicken Shabiya 11',
                city: 'Abu Dhabi',
                direction: '24.328366371847554, 54.535004577124376',
                area: 'Mohamed Bin Zayed City - ME-11',
                landline: '(02) 554 9889',
                googleSite: 'https://g.co/kgs/QQh8CXL',
                rate: 3.7,
                manager: 'Mr. Zakaria',
                managerNumber: '971 56 269 0688',
                email: 'shabiha@crispychicken.rest',
                deliveryStatus: 'Yes',
                linkOnline: 'http://crispychicken-uae.com/#_branch94472',
                createdAt: new Date().toISOString()
            },
            {
                id: 3,
                name: 'Crispy chicken khaldia',
                city: 'Abu Dhabi',
                direction: '24.47955696172264, 54.353930808868604',
                area: 'Khalidiya Tower - Al Khalidiya Street - opp. Grand Store',
                landline: '(02) 546 0900',
                googleSite: 'https://g.co/kgs/Du9UqrY',
                rate: 3.9,
                manager: 'Mr. Adel',
                managerNumber: '971 56 949 4764',
                email: 'crispychicken.khalidia@gmail.com',
                deliveryStatus: 'Yes',
                linkOnline: 'http://alkhalidiyah.crispychicken-uae.com/#_branch94938',
                createdAt: new Date().toISOString()
            },
            {
                id: 4,
                name: 'Crispy chicken Elactra',
                city: 'Abu Dhabi',
                direction: '',
                area: 'Electra street opp LLH hospital',
                landline: '(02)8826902',
                googleSite: '',
                rate: 0,
                manager: 'Mr. RJ',
                managerNumber: '971 56 386 6859',
                email: 'electra@crispychicken.rest',
                deliveryStatus: 'N/A',
                linkOnline: 'N/A',
                createdAt: new Date().toISOString()
            },
            {
                id: 5,
                name: 'Crispy chicken Muroor',
                city: 'Abu Dhabi',
                direction: '24.434503442604896, 54.43866580679551',
                area: '31 Muroor Rd - Al Sa\'adah - Zone 1',
                landline: '(02) 563 3359',
                googleSite: 'https://g.co/kgs/qS1e4Bi',
                rate: 4,
                manager: 'Mr. Tariq',
                managerNumber: '971 50 541 4641',
                email: 'MOUROOR@CRISPYCHICKEN.REST',
                deliveryStatus: 'Yes',
                linkOnline: 'http://almuroorroad.crispychicken-uae.com/#_branch102831',
                createdAt: new Date().toISOString()
            },
            {
                id: 6,
                name: 'Crispy chicken Al Barsha',
                city: 'Dubai',
                direction: '25.11589564435004, 55.20455565397946',
                area: 'Al Barsha 1',
                landline: '(04) 835 8195',
                googleSite: 'https://g.co/kgs/6xh7DNw',
                rate: 4.4,
                manager: 'Mr. Zaid',
                managerNumber: '971 56 740 5572',
                email: 'barsha@crispychicken.rest',
                deliveryStatus: 'Yes',
                linkOnline: 'http://albarsha.crispychicken-uae.com/#_branch124062',
                createdAt: new Date().toISOString()
            },
            {
                id: 7,
                name: 'Crispy chicken Al Satwa',
                city: 'Dubai',
                direction: '25.232522002773372, 55.2694237276173',
                area: 'Satwa street Dubai',
                landline: '(04)3265878',
                googleSite: 'https://maps.app.goo.gl/XnyngSy4wgtSLRfc8',
                rate: 4.5,
                manager: 'Mr. Musab',
                managerNumber: '971 56 797 0685',
                email: 'satwa@crispychicken.rest',
                deliveryStatus: 'Yes',
                linkOnline: 'http://satwa.crispychicken-uae.com/#_branch173500',
                createdAt: new Date().toISOString()
            },
            {
                id: 8,
                name: 'Crispy chicken Al Regga',
                city: 'Dubai',
                direction: '25.0765, 55.1456',
                area: 'Al Rigga Street',
                landline: '(04) 123 4567',
                googleSite: 'https://g.co/kgs/AbCdEfG',
                rate: 4.2,
                manager: 'Mr. Ahmed',
                managerNumber: '971 55 123 4567',
                email: 'rigga@crispychicken.rest',
                deliveryStatus: 'Yes',
                linkOnline: 'http://alrigga.crispychicken-uae.com',
                createdAt: new Date().toISOString()
            }
        ];
        let platforms = JSON.parse(localStorage.getItem('crispyPlatforms')) || [
            { id: 1, name: 'Self Delivery', code: 'self_delivery', url: '', commission: 0, status: 'active', notes: 'التوصيل الذاتي', priority: 'medium' },
            { id: 2, name: 'Online', code: 'online', url: '', commission: 0, status: 'active', notes: 'الطلبات عبر الموقع الإلكتروني', priority: 'high' },
            { id: 3, name: 'Deliveroo', code: 'deliveroo', url: 'https://deliveroo.ae', commission: 25, status: 'active', notes: 'منصة توصيل دولية', priority: 'high' },
            { id: 4, name: 'Talabat', code: 'talabat', url: 'https://talabat.com', commission: 20, status: 'active', notes: 'منصة توصيل إقليمية', priority: 'high' },
            { id: 5, name: 'Smile', code: 'smile', url: 'https://smile.com.ae', commission: 18, status: 'active', notes: 'خدمة التوصيل الممتازة', priority: 'medium' },
            { id: 6, name: 'Noon', code: 'noon', url: 'https://noon.com', commission: 15, status: 'active', notes: 'منصة التوصيل الأكثر استخداماً', priority: 'high' },
            { id: 7, name: 'Careem', code: 'careem', url: 'https://careem.com', commission: 20, status: 'active', notes: 'خدمة التوصيل السريعة', priority: 'high' }
        ];
        
        // عروض سابقة مبدئية
        let pastOffers = JSON.parse(localStorage.getItem('crispyPastOffers')) || [
            {
                id: 1,
                startDate: '2023-09-09',
                endDate: '2023-09-15',
                details: 'Talabat Offer\n8 pieces of crispy chicken + 2 garlic sauces (Chicken Day)\nPrice: 29 AED',
                availability: ['talabat'],
                createdAt: new Date().toISOString()
            },
            {
                id: 2,
                startDate: '2023-09-13',
                endDate: '2023-09-15',
                details: 'Weekend Offer on Smile\nDiscount from Smiles app (provided by Smiles, not Crispy Chicken)',
                availability: ['smile'],
                createdAt: new Date().toISOString()
            },
            {
                id: 3,
                startDate: '2023-09-16',
                endDate: '2023-09-17',
                details: 'Monday & Tuesday Special Offer!\n8 pieces of crispy chicken + 2 garlic sauces\nPrice: 25 AED\nOrder online via website:\n🌐 www.crispychicken-uae.com',
                availability: ['online', 'self_delivery'],
                createdAt: new Date().toISOString()
            },
            {
                id: 4,
                startDate: '2023-09-18',
                endDate: '2023-09-22',
                details: 'Big Food Fest Offer\n8 pieces of crispy chicken + 2 garlic sauces (Chicken Day)\nPrice: 29 AED',
                availability: ['noon'],
                createdAt: new Date().toISOString()
            },
            {
                id: 5,
                startDate: '2023-09-19',
                endDate: '2023-09-30',
                details: 'Careem Offer\n50% off up to 20 AED\nAvailable in Abu Dhabi and Dubai',
                availability: ['careem'],
                createdAt: new Date().toISOString()
            },
            {
                id: 6,
                startDate: '2023-09-24',
                endDate: '2023-09-30',
                details: 'Noon App Offer\n30% off on 3 selected items:\n- Twin Twist\n- Twin Supreme\n- Tornado Combo',
                availability: ['noon'],
                createdAt: new Date().toISOString()
            },
            {
                id: 7,
                startDate: '2023-09-29',
                endDate: '2023-09-29',
                details: 'Chicken Day Offer\n8 pieces of crispy chicken + 2 garlic sauces\nPrice: 29 AED',
                availability: ['noon'],
                createdAt: new Date().toISOString()
            },
            {
                id: 8,
                startDate: '2023-09-24',
                endDate: '2023-09-30',
                details: '30% off on 3 selected items only\nTwin twist\nTwin Supreme\nTornado combo\n24 to 30 Sep\nNoon app',
                availability: ['noon'],
                createdAt: new Date().toISOString()
            },
            {
                id: 9,
                startDate: '2023-09-24',
                endDate: '2023-09-30',
                details: '30% off on 4 selected items only\nTwin twist\nSaving meal\nTornado combo\nCrispy strips meal\n24 to 30 Sep\nTALABAT app',
                availability: ['talabat'],
                createdAt: new Date().toISOString()
            }
        ];
        
        let salesTrendChart, branchComparisonChart, offerProfitabilityChart, platformPerformanceChart;
        let selectedOffers = new Set();
        let selectedSales = new Set();
        let selectedBranches = new Set();
        let selectedPlatforms = new Set();
        let selectedPastOffers = new Set();
        
        // Keyboard shortcuts
        const shortcuts = {
            'Ctrl+s': () => document.querySelector('#offerForm')?.submit(),
            'Ctrl+n': () => showTab('offers'),
            'Ctrl+b': () => showTab('branches'),
            'Ctrl+p': () => showTab('platforms'),
            'Ctrl+h': () => showTab('pastOffers'),
            'Ctrl+a': () => showTab('analysis'),
            'Ctrl+f': () => document.getElementById('globalSearch')?.focus(),
            'Escape': () => closeAllModals()
        };
        
        // Initialize keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                const key = `${e.ctrlKey ? 'Ctrl' : 'Meta'}+${e.key.toLowerCase()}`;
                if (shortcuts[key]) {
                    e.preventDefault();
                    shortcuts[key]();
                }
            } else if (e.key === 'Escape') {
                shortcuts['Escape']();
            }
        });
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // Show tab
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            const menuItems = document.querySelectorAll('.menu-item');
            const breadcrumb = document.getElementById('breadcrumbCurrent');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            menuItems.forEach(item => item.classList.remove('active'));
            
            const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            const activeContent = document.getElementById(tabName);
            const activeMenuItem = document.querySelector(`.menu-item[onclick="showTab('${tabName}')"]`);
            
            if (activeTab) activeTab.classList.add('active');
            if (activeContent) activeContent.classList.add('active');
            if (activeMenuItem) activeMenuItem.classList.add('active');
            
            // Update breadcrumb
            const tabNames = {
                'offers': 'إدارة العروض',
                'sales': 'تسجيل المبيعات',
                'branches': 'إدارة الفروع',
                'platforms': 'إدارة المنصات',
                'pastOffers': 'العروض السابقة',
                'analysis': 'التحليلات',
                'reports': 'التقارير',
                'settings': 'الإعدادات'
            };
            breadcrumb.textContent = tabNames[tabName] || tabName;
            
            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                toggleSidebar();
            }
            
            // Load tab-specific data
            if (tabName === 'analysis') {
                updateAnalysis();
            } else if (tabName === 'branches') {
                updateBranchesList();
            } else if (tabName === 'platforms') {
                updatePlatformsList();
                updatePlatformsGrid();
            } else if (tabName === 'pastOffers') {
                updatePastOffersTable();
                updatePlatformsGrid();
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('crispyOffers', JSON.stringify(offers));
            localStorage.setItem('crispySales', JSON.stringify(sales));
            localStorage.setItem('crispyBranches', JSON.stringify(branches));
            localStorage.setItem('crispyPlatforms', JSON.stringify(platforms));
            localStorage.setItem('crispyPastOffers', JSON.stringify(pastOffers));
        }
        
        // Show notification
        function showNotification(message, type = 'success', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="notification-icon ${icons[type]}"></i>
                <span>${message}</span>
                <i class="fas fa-times notification-close" onclick="this.parentElement.remove()"></i>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after duration
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);
        }
        
        // Add new offer
        document.getElementById('offerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const offer = {
                id: Date.now(),
                name: document.getElementById('offerName').value,
                code: document.getElementById('offerCode').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                products: document.getElementById('products').value,
                regularPrice: parseFloat(document.getElementById('regularPrice').value),
                offerPrice: parseFloat(document.getElementById('offerPrice').value),
                estimatedCost: parseFloat(document.getElementById('estimatedCost').value),
                maxOrders: parseInt(document.getElementById('maxOrders').value) || 0,
                notes: document.getElementById('offerNotes').value,
                status: 'نشط',
                createdAt: new Date().toISOString()
            };
            
            // Calculate discount and profit
            offer.discount = ((offer.regularPrice - offer.offerPrice) / offer.regularPrice * 100).toFixed(1) + '%';
            offer.profit = (offer.offerPrice - offer.estimatedCost).toFixed(2);
            
            offers.push(offer);
            saveData();
            updateOffersTable();
            updateOfferSelects();
            this.reset();
            showNotification('تم إضافة العرض بنجاح!');
        });
        
        // Update offers table
        function updateOffersTable() {
            const tbody = document.querySelector('#offersTable tbody');
            tbody.innerHTML = '';
            
            const activeOffers = offers.filter(offer => offer.status === 'نشط');
            
            activeOffers.forEach(offer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="offer-checkbox" data-id="${offer.id}" onchange="toggleSelection('offers', ${offer.id})">
                    </td>
                    <td>${offer.name}</td>
                    <td>${offer.code}</td>
                    <td>${offer.discount}</td>
                    <td>${offer.offerPrice} درهم</td>
                    <td>${offer.profit} درهم</td>
                    <td>
                        <span class="status-badge status-active">${offer.status}</span>
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm btn-outline" onclick="showOfferDetails(${offer.id})" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="archiveOffer(${offer.id})" title="أرشفة">
                                <i class="fas fa-archive"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteOffer(${offer.id})" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Archive offer
        function archiveOffer(id) {
            const offer = offers.find(o => o.id === id);
            if (offer) {
                offer.status = 'منتهي';
                offer.archivedAt = new Date().toISOString();
                saveData();
                updateOffersTable();
                updatePastOffersTable();
                showNotification('تم أرشفة العرض بنجاح!');
            }
        }
        
        // Delete offer
        function deleteOffer(id) {
            if (confirm('هل أنت متأكد من حذف هذا العرض؟')) {
                offers = offers.filter(offer => offer.id !== id);
                saveData();
                updateOffersTable();
                updateOfferSelects();
                updatePastOffersTable();
                showNotification('تم حذف العرض بنجاح!');
            }
        }
        
        // Update offer selects
        function updateOfferSelects() {
            const offerFilter = document.getElementById('offerFilter');
            const salesOffer = document.getElementById('salesOffer');
            
            // Update filter
            offerFilter.innerHTML = '<option value="">جميع العروض</option>';
            offers.forEach(offer => {
                const option = document.createElement('option');
                option.value = offer.code;
                option.textContent = offer.name;
                offerFilter.appendChild(option);
            });
            
            // Update sales form
            salesOffer.innerHTML = '<option value="">اختر العرض</option>';
            offers.filter(offer => offer.status === 'نشط').forEach(offer => {
                const option = document.createElement('option');
                option.value = offer.code;
                option.textContent = offer.name;
                salesOffer.appendChild(option);
            });
        }
        
        // Add new sales
        document.getElementById('salesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const offerCode = document.getElementById('salesOffer').value;
            const offer = offers.find(o => o.code === offerCode);
            
            if (!offer) {
                showNotification('العرض المحدد غير موجود!', 'error');
                return;
            }
            
            const sale = {
                id: Date.now(),
                branch: document.getElementById('branchName').value,
                platform: document.getElementById('platformName').value,
                offerCode: offerCode,
                week: parseInt(document.getElementById('weekNumber').value),
                orderCount: parseInt(document.getElementById('orderCount').value),
                actualCost: parseFloat(document.getElementById('actualCost').value),
                notes: document.getElementById('salesNotes').value,
                revenue: offer.offerPrice * parseInt(document.getElementById('orderCount').value),
                profit: (offer.offerPrice * parseInt(document.getElementById('orderCount').value)) - parseFloat(document.getElementById('actualCost').value),
                createdAt: new Date().toISOString()
            };
            
            // Calculate growth
            const previousWeek = sales.filter(s => 
                s.branch === sale.branch && 
                s.platform === sale.platform &&
                s.offerCode === sale.offerCode && 
                s.week === sale.week - 1
            );
            
            if (previousWeek.length > 0) {
                const growth = ((sale.revenue - previousWeek[0].revenue) / previousWeek[0].revenue * 100).toFixed(1);
                sale.growth = growth + '%';
            } else {
                sale.growth = 'جديد';
            }
            
            sales.push(sale);
            saveData();
            updateSalesTable();
            this.reset();
            showNotification('تم تسجيل المبيعات بنجاح!');
        });
        
        // Update sales table
        function updateSalesTable() {
            const tbody = document.querySelector('#salesTable tbody');
            tbody.innerHTML = '';
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${getBranchName(sale.branch)}</td>
                    <td>${getPlatformName(sale.platform)}</td>
                    <td>${sale.offerCode}</td>
                    <td>${sale.week}</td>
                    <td>${sale.orderCount}</td>
                    <td>${sale.revenue.toLocaleString()} درهم</td>
                    <td>${sale.profit.toFixed(2)} درهم</td>
                    <td>${sale.growth}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm btn-outline" onclick="editSale(${sale.id})" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSale(${sale.id})" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Delete sale
        function deleteSale(id) {
            if (confirm('هل أنت متأكد من حذف هذا السجل؟')) {
                sales = sales.filter(sale => sale.id !== id);
                saveData();
                updateSalesTable();
                showNotification('تم حذف السجل بنجاح!');
            }
        }
        
        // Get branch name
        function getBranchName(branchCode) {
            const branch = branches.find(b => b.code === branchCode);
            return branch ? branch.name : branchCode;
        }
        
        // Get platform name
        function getPlatformName(platformCode) {
            const platform = platforms.find(p => p.code === platformCode);
            return platform ? platform.name : platformCode;
        }
        
        // Add new branch
        document.getElementById('branchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Generate automatic code
            const branchName = document.getElementById('branchNameInput').value;
            const city = document.getElementById('branchCity').value;
            let code = branchName.toLowerCase().replace(/\s+/g, '_');
            
            // Ensure code uniqueness
            let counter = 1;
            let originalCode = code;
            while (branches.some(b => b.code === code)) {
                code = originalCode + '_' + counter;
                counter++;
            }
            
            const branch = {
                id: Date.now(),
                name: branchName,
                code: code,
                city: city,
                direction: document.getElementById('branchDirection').value,
                area: document.getElementById('branchArea').value,
                landline: document.getElementById('branchLandline').value,
                googleSite: document.getElementById('branchGoogleSite').value,
                rate: parseFloat(document.getElementById('branchRate').value) || 0,
                manager: document.getElementById('branchManager').value,
                managerNumber: document.getElementById('branchManagerNumber').value,
                email: document.getElementById('branchEmail').value,
                deliveryStatus: document.getElementById('branchDeliveryStatus').value,
                linkOnline: document.getElementById('branchLinkOnline').value,
                createdAt: new Date().toISOString()
            };
            
            branches.push(branch);
            saveData();
            updateBranchesList();
            updateBranchSelects();
            this.reset();
            showNotification('تم إضافة الفرع بنجاح!');
        });
        
        // Update branches list
        function updateBranchesList() {
            const branchesList = document.getElementById('branchesList');
            branchesList.innerHTML = '';
            
            branches.forEach(branch => {
                const branchCard = document.createElement('div');
                branchCard.className = 'card';
                branchCard.style.marginBottom = '20px';
                
                branchCard.innerHTML = `
                    <div class="card-header">
                        <h3>${branch.name}</h3>
                        <div class="card-actions">
                            <button class="btn btn-sm btn-outline" onclick="showBranchDetails(${branch.id})">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editBranch(${branch.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBranch(${branch.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="branch-details">
                        <p><i class="fas fa-map-marker-alt"></i> <strong>المدينة:</strong> ${getCityName(branch.city)}</p>
                        <p><i class="fas fa-location-dot"></i> <strong>المنطقة:</strong> ${branch.area}</p>
                        <p><i class="fas fa-user-tie"></i> <strong>المدير:</strong> ${branch.manager}</p>
                        <p><i class="fas fa-truck"></i> <strong>حالة التوصيل:</strong> ${getDeliveryStatusBadge(branch.deliveryStatus)}</p>
                        <p><i class="fas fa-star"></i> <strong>التقييم:</strong> ${branch.rate > 0 ? branch.rate + ' / 5' : 'غير متوفر'}</p>
                    </div>
                `;
                
                branchesList.appendChild(branchCard);
            });
        }
        
        // Show branch details
        function showBranchDetails(id) {
            const branch = branches.find(b => b.id === id);
            if (!branch) return;
            
            const modal = document.getElementById('branchDetailsModal');
            const content = document.getElementById('branchDetailsContent');
            
            content.innerHTML = `
                <div class="branch-detail-row">
                    <div class="branch-detail-label">الاسم:</div>
                    <div class="branch-detail-value">${branch.name}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">المدينة:</div>
                    <div class="branch-detail-value">${getCityName(branch.city)}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">المنطقة:</div>
                    <div class="branch-detail-value">${branch.area}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">الإحداثيات:</div>
                    <div class="branch-detail-value">${branch.direction || 'غير متوفر'}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">الهاتف الأرضي:</div>
                    <div class="branch-detail-value">${branch.landline || 'غير متوفر'}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">رابط جوجل:</div>
                    <div class="branch-detail-value">${branch.googleSite ? `<a href="${branch.googleSite}" target="_blank">${branch.googleSite}</a>` : 'غير متوفر'}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">التقييم:</div>
                    <div class="branch-detail-value">${branch.rate > 0 ? branch.rate + ' / 5' : 'غير متوفر'}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">المدير:</div>
                    <div class="branch-detail-value">${branch.manager}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">رقم المدير:</div>
                    <div class="branch-detail-value">${branch.managerNumber}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">البريد الإلكتروني:</div>
                    <div class="branch-detail-value">${branch.email || 'غير متوفر'}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">حالة التوصيل:</div>
                    <div class="branch-detail-value">${getDeliveryStatusBadge(branch.deliveryStatus)}</div>
                </div>
                <div class="branch-detail-row">
                    <div class="branch-detail-label">الرابط الإلكتروني:</div>
                    <div class="branch-detail-value">${branch.linkOnline && branch.linkOnline !== 'N/A' ? `<a href="${branch.linkOnline}" target="_blank">${branch.linkOnline}</a>` : 'غير متوفر'}</div>
                </div>
                
                ${branch.direction ? `
                <div class="map-container">
                    <iframe 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        style="border:0" 
                        src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dOWTgaLzB3tq9Y&q=${branch.direction}" 
                        allowfullscreen>
                    </iframe>
                </div>
                ` : ''}
            `;
            
            modal.classList.add('active');
        }
        
        // Edit branch
        function editBranch(id) {
            const branch = branches.find(b => b.id === id);
            if (branch) {
                document.getElementById('branchNameInput').value = branch.name;
                document.getElementById('branchCity').value = branch.city;
                document.getElementById('branchDirection').value = branch.direction;
                document.getElementById('branchArea').value = branch.area;
                document.getElementById('branchLandline').value = branch.landline;
                document.getElementById('branchGoogleSite').value = branch.googleSite;
                document.getElementById('branchRate').value = branch.rate;
                document.getElementById('branchManager').value = branch.manager;
                document.getElementById('branchManagerNumber').value = branch.managerNumber;
                document.getElementById('branchEmail').value = branch.email;
                document.getElementById('branchDeliveryStatus').value = branch.deliveryStatus;
                document.getElementById('branchLinkOnline').value = branch.linkOnline;
                
                // Remove old branch
                branches = branches.filter(b => b.id !== id);
                saveData();
                updateBranchesList();
                updateBranchSelects();
                
                showNotification('تم تحميل بيانات الفرع للتعديل');
            }
        }
        
        // Delete branch
        function deleteBranch(id) {
            if (confirm('هل أنت متأكد من حذف هذا الفرع؟')) {
                branches = branches.filter(branch => branch.id !== id);
                saveData();
                updateBranchesList();
                updateBranchSelects();
                showNotification('تم حذف الفرع بنجاح!');
            }
        }
        
        // Get city name
        function getCityName(cityCode) {
            const cities = {
                'Abu Dhabi': 'أبوظبي',
                'Dubai': 'دبي',
                'Sharjah': 'الشارقة',
                'Ajman': 'عجمان',
                'Umm Al Quwain': 'أم القيوين',
                'Ras Al Khaimah': 'رأس الخيمة',
                'Fujairah': 'الفجيرة'
            };
            return cities[cityCode] || cityCode;
        }
        
        // Get delivery status badge
        function getDeliveryStatusBadge(status) {
            if (status === 'Yes') {
                return '<span class="status-badge status-active">متاح</span>';
            } else if (status === 'No') {
                return '<span class="status-badge status-inactive">غير متاح</span>';
            } else {
                return '<span class="status-badge status-pending">غير متوفر</span>';
            }
        }
        
        // Update branch selects
        function updateBranchSelects() {
            const branchFilter = document.getElementById('branchFilter');
            const branchName = document.getElementById('branchName');
            
            // Update filter
            branchFilter.innerHTML = '<option value="">جميع الفروع</option>';
            branches.forEach(branch => {
                const option = document.createElement('option');
                option.value = branch.code;
                option.textContent = branch.name;
                branchFilter.appendChild(option);
            });
            
            // Update sales form
            branchName.innerHTML = '<option value="">اختر الفرع</option>';
            branches.forEach(branch => {
                const option = document.createElement('option');
                option.value = branch.code;
                option.textContent = branch.name;
                branchName.appendChild(option);
            });
        }
        
        // Add new platform
        document.getElementById('platformType').addEventListener('change', function() {
            const customPlatformName = document.getElementById('customPlatformName');
            if (this.value === 'other') {
                customPlatformName.style.display = 'block';
            } else {
                customPlatformName.style.display = 'none';
            }
        });
        
        document.getElementById('platformForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const platformType = document.getElementById('platformType').value;
            let platformName = '';
            
            if (platformType === 'other') {
                platformName = document.getElementById('customPlatformNameInput').value;
            } else {
                const platformNames = {
                    'self_delivery': 'Self Delivery',
                    'online': 'Online',
                    'deliveroo': 'Deliveroo',
                    'talabat': 'Talabat',
                    'smile': 'Smile',
                    'noon': 'Noon',
                    'careem': 'Careem'
                };
                platformName = platformNames[platformType];
            }
            
            const platform = {
                id: Date.now(),
                name: platformName,
                code: platformType === 'other' ? document.getElementById('customPlatformNameInput').value.toLowerCase().replace(/\s+/g, '') : platformType,
                url: document.getElementById('platformUrl').value,
                commission: parseFloat(document.getElementById('platformCommission').value) || 0,
                status: document.getElementById('platformStatus').value,
                priority: document.getElementById('platformPriority').value,
                notes: document.getElementById('platformNotes').value,
                createdAt: new Date().toISOString()
            };
            
            platforms.push(platform);
            saveData();
            updatePlatformsList();
            updatePlatformSelects();
            updatePlatformsGrid();
            this.reset();
            document.getElementById('customPlatformName').style.display = 'none';
            showNotification('تم إضافة المنصة بنجاح!');
        });
        
        // Update platforms list
        function updatePlatformsList() {
            const platformsList = document.getElementById('platformsList');
            platformsList.innerHTML = '';
            
            platforms.forEach(platform => {
                const platformCard = document.createElement('div');
                platformCard.className = 'card';
                platformCard.style.marginBottom = '20px';
                
                let iconSrc = '';
                if (platform.code === 'noon') {
                    iconSrc = 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Noon.com_logo.svg/1200px-Noon.com_logo.svg.png';
                } else if (platform.code === 'careem') {
                    iconSrc = 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Careem_logo.svg/1200px-Careem_logo.svg.png';
                } else if (platform.code === 'smile') {
                    iconSrc = 'https://smile.com.ae/assets/images/logo.png';
                } else if (platform.code === 'talabat') {
                    iconSrc = 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Talabat_logo.svg/1200px-Talabat_logo.svg.png';
                } else if (platform.code === 'deliveroo') {
                    iconSrc = 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Deliveroo_logo.svg/1200px-Deliveroo_logo.svg.png';
                } else {
                    iconSrc = 'https://via.placeholder.com/50';
                }
                
                const priorityColors = {
                    high: '#f44336',
                    medium: '#ff9800',
                    low: '#4caf50'
                };
                
                platformCard.innerHTML = `
                    <div class="card-header">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <img src="${iconSrc}" alt="${platform.name}" style="width: 50px; height: 50px; border-radius: 8px;">
                            <div>
                                <h3>${platform.name}</h3>
                                <span class="status-badge" style="background: ${priorityColors[platform.priority]}; color: white;">
                                    ${platform.priority === 'high' ? 'عالية' : platform.priority === 'medium' ? 'متوسطة' : 'منخفضة'}
                                </span>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-sm btn-outline" onclick="editPlatform(${platform.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deletePlatform(${platform.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="platform-info">
                        <p><i class="fas fa-link"></i> <strong>الرابط:</strong> ${platform.url ? `<a href="${platform.url}" target="_blank">${platform.url}</a>` : 'غير متوفر'}</p>
                        <p><i class="fas fa-percentage"></i> <strong>العمولة:</strong> ${platform.commission}%</p>
                        <p><i class="fas fa-info-circle"></i> <strong>الحالة:</strong> ${platform.status === 'active' ? 'نشطة' : platform.status === 'inactive' ? 'غير نشطة' : 'صيانة'}</p>
                        <p><i class="fas fa-sticky-note"></i> <strong>ملاحظات:</strong> ${platform.notes}</p>
                    </div>
                `;
                
                platformsList.appendChild(platformCard);
            });
        }
        
        // Update platforms grid
        function updatePlatformsGrid() {
            const platformsGrid = document.getElementById('platformsGrid');
            platformsGrid.innerHTML = '';
            
            platforms.forEach(platform => {
                const chip = document.createElement('div');
                chip.className = 'platform-chip';
                chip.dataset.code = platform.code;
                
                const icons = {
                    self_delivery: 'fas fa-truck',
                    online: 'fas fa-globe',
                    deliveroo: 'fas fa-motorcycle',
                    talabat: 'fas fa-mobile-alt',
                    smile: 'fas fa-smile',
                    noon: 'fas fa-sun',
                    careem: 'fas fa-car'
                };
                
                chip.innerHTML = `
                    <i class="${icons[platform.code] || 'fas fa-cube'}"></i>
                    ${platform.name}
                `;
                
                chip.onclick = function() {
                    this.classList.toggle('selected');
                };
                
                platformsGrid.appendChild(chip);
            });
        }
        
        // Edit platform
        function editPlatform(id) {
            const platform = platforms.find(p => p.id === id);
            if (platform) {
                document.getElementById('platformType').value = platform.code === 'self_delivery' || platform.code === 'online' || platform.code === 'deliveroo' || platform.code === 'talabat' || platform.code === 'smile' || platform.code === 'noon' || platform.code === 'careem' ? platform.code : 'other';
                
                if (platform.code === 'self_delivery' || platform.code === 'online' || platform.code === 'deliveroo' || platform.code === 'talabat' || platform.code === 'smile' || platform.code === 'noon' || platform.code === 'careem') {
                    document.getElementById('customPlatformName').style.display = 'none';
                } else {
                    document.getElementById('customPlatformName').style.display = 'block';
                    document.getElementById('customPlatformNameInput').value = platform.name;
                }
                
                document.getElementById('platformUrl').value = platform.url;
                document.getElementById('platformCommission').value = platform.commission;
                document.getElementById('platformStatus').value = platform.status;
                document.getElementById('platformPriority').value = platform.priority;
                document.getElementById('platformNotes').value = platform.notes;
                
                // Remove old platform
                platforms = platforms.filter(p => p.id !== id);
                saveData();
                updatePlatformsList();
                updatePlatformSelects();
                updatePlatformsGrid();
                
                showNotification('تم تحميل بيانات المنصة للتعديل');
            }
        }
        
        // Delete platform
        function deletePlatform(id) {
            if (confirm('هل أنت متأكد من حذف هذه المنصة؟')) {
                platforms = platforms.filter(platform => platform.id !== id);
                saveData();
                updatePlatformsList();
                updatePlatformSelects();
                updatePlatformsGrid();
                showNotification('تم حذف المنصة بنجاح!');
            }
        }
        
        // Update platform selects
        function updatePlatformSelects() {
            const platformFilter = document.getElementById('platformFilter');
            const platformName = document.getElementById('platformName');
            
            // Update filter
            platformFilter.innerHTML = '<option value="">جميع المنصات</option>';
            platforms.forEach(platform => {
                const option = document.createElement('option');
                option.value = platform.code;
                option.textContent = platform.name;
                platformFilter.appendChild(option);
            });
            
            // Update sales form
            platformName.innerHTML = '<option value="">اختر المنصة</option>';
            platforms.forEach(platform => {
                const option = document.createElement('option');
                option.value = platform.code;
                option.textContent = platform.name;
                platformName.appendChild(option);
            });
        }
        
        // Add past offer
        document.getElementById('pastOfferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get selected platforms
            const selectedPlatforms = Array.from(document.querySelectorAll('.platform-chip.selected'))
                .map(chip => chip.dataset.code);
            
            if (selectedPlatforms.length === 0) {
                showNotification('الرجاء اختيار منصة واحدة على الأقل!', 'error');
                return;
            }
            
            const pastOffer = {
                id: Date.now(),
                startDate: document.getElementById('pastOfferStartDate').value,
                endDate: document.getElementById('pastOfferEndDate').value,
                details: document.getElementById('pastOfferDetails').value,
                availability: selectedPlatforms,
                createdAt: new Date().toISOString()
            };
            
            pastOffers.push(pastOffer);
            saveData();
            updatePastOffersTable();
            this.reset();
            
            // Reset platforms grid
            document.querySelectorAll('.platform-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            
            showNotification('تم إضافة العرض السابق بنجاح!');
        });
        
        // Update past offers table
        function updatePastOffersTable() {
            const tbody = document.querySelector('#pastOffersTable tbody');
            tbody.innerHTML = '';
            
            pastOffers.forEach(offer => {
                const row = document.createElement('tr');
                
                // Format date range
                const startDate = new Date(offer.startDate);
                const endDate = new Date(offer.endDate);
                let dateRange = '';
                
                if (startDate.getMonth() === endDate.getMonth() && startDate.getFullYear() === endDate.getFullYear()) {
                    dateRange = `${startDate.getDate()}-${endDate.getDate()} ${getMonthName(startDate.getMonth())} ${startDate.getFullYear()}`;
                } else {
                    dateRange = `${getMonthName(startDate.getMonth())} ${startDate.getDate()} - ${getMonthName(endDate.getMonth())} ${endDate.getDate()}, ${startDate.getFullYear()}`;
                }
                
                // Format availability
                const availabilityNames = offer.availability.map(code => getPlatformName(code)).join(', ');
                
                row.innerHTML = `
                    <td>${dateRange}</td>
                    <td>${offer.details.replace(/\n/g, '<br>')}</td>
                    <td>${availabilityNames}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm btn-outline" onclick="showPastOfferDetails(${offer.id})" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deletePastOffer(${offer.id})" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Get month name
        function getMonthName(monthIndex) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return months[monthIndex];
        }
        
        // Delete past offer
        function deletePastOffer(id) {
            if (confirm('هل أنت متأكد من حذف هذا العرض السابق؟')) {
                pastOffers = pastOffers.filter(offer => offer.id !== id);
                saveData();
                updatePastOffersTable();
                showNotification('تم حذف العرض السابق بنجاح!');
            }
        }
        
        // Search past offers
        function searchPastOffers() {
            const searchTerm = document.getElementById('searchPastOffers').value.toLowerCase();
            const rows = document.querySelectorAll('#pastOffersTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Update analysis
        function updateAnalysis() {
            // Calculate KPIs
            const totalRevenue = sales.reduce((sum, sale) => sum + sale.revenue, 0);
            const totalProfit = sales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalOrders = sales.reduce((sum, sale) => sum + sale.orderCount, 0);
            const avgOrderValue = totalOrders > 0 ? (totalRevenue / totalOrders).toFixed(2) : 0;
            
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
            document.getElementById('totalProfit').textContent = totalProfit.toLocaleString();
            document.getElementById('avgOrderValue').textContent = avgOrderValue;
            document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
            
            // Update charts
            updateSalesTrendChart();
            updateBranchComparisonChart();
            updateOfferProfitabilityChart();
            updatePlatformPerformanceChart();
        }
        
        // Update sales trend chart
        function updateSalesTrendChart() {
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            
            // Group data by weeks
            const weeks = [...new Set(sales.map(sale => sale.week))].sort();
            const revenueByWeek = weeks.map(week => {
                return sales
                    .filter(sale => sale.week === week)
                    .reduce((sum, sale) => sum + sale.revenue, 0);
            });
            
            if (salesTrendChart) {
                salesTrendChart.destroy();
            }
            
            salesTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks.map(week => `الأسبوع ${week}`),
                    datasets: [{
                        label: 'الإيرادات (درهم)',
                        data: revenueByWeek,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'اتجاهات المبيعات الأسبوعية'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Update branch comparison chart
        function updateBranchComparisonChart() {
            const ctx = document.getElementById('branchComparisonChart').getContext('2d');
            
            // Group data by branches
            const branchCodes = [...new Set(sales.map(sale => sale.branch))];
            const revenueByBranch = branchCodes.map(code => {
                return sales
                    .filter(sale => sale.branch === code)
                    .reduce((sum, sale) => sum + sale.revenue, 0);
            });
            
            if (branchComparisonChart) {
                branchComparisonChart.destroy();
            }
            
            branchComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: branchCodes.map(code => getBranchName(code)),
                    datasets: [{
                        label: 'الإيرادات (درهم)',
                        data: revenueByBranch,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'مقارنة أداء الفروع'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Update offer profitability chart
        function updateOfferProfitabilityChart() {
            const ctx = document.getElementById('offerProfitabilityChart').getContext('2d');
            
            // Group data by offers
            const offerCodes = [...new Set(sales.map(sale => sale.offerCode))];
            const profitByOffer = offerCodes.map(code => {
                return sales
                    .filter(sale => sale.offerCode === code)
                    .reduce((sum, sale) => sum + sale.profit, 0);
            });
            
            if (offerProfitabilityChart) {
                offerProfitabilityChart.destroy();
            }
            
            offerProfitabilityChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: offerCodes,
                    datasets: [{
                        label: 'الربح (درهم)',
                        data: profitByOffer,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'تحليل ربحية العروض'
                        }
                    }
                }
            });
        }
        
        // Update platform performance chart
        function updatePlatformPerformanceChart() {
            const ctx = document.getElementById('platformPerformanceChart').getContext('2d');
            
            // Group data by platforms
            const platformCodes = [...new Set(sales.map(sale => sale.platform))];
            const revenueByPlatform = platformCodes.map(code => {
                return sales
                    .filter(sale => sale.platform === code)
                    .reduce((sum, sale) => sum + sale.revenue, 0);
            });
            
            if (platformPerformanceChart) {
                platformPerformanceChart.destroy();
            }
            
            platformPerformanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: platformCodes.map(code => getPlatformName(code)),
                    datasets: [{
                        label: 'الإيرادات (درهم)',
                        data: revenueByPlatform,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'أداء المنصات'
                        }
                    }
                }
            });
        }
        
        // Utility functions
        function resetForm(formId) {
            document.getElementById(formId).reset();
            showNotification('تم إعادة تعيين النموذج', 'info');
        }
        
        function toggleSelection(type, id) {
            const checkbox = document.querySelector(`.${type}-checkbox[data-id="${id}"]`);
            if (checkbox) {
                if (checkbox.checked) {
                    if (type === 'offers') selectedOffers.add(id);
                    else if (type === 'sales') selectedSales.add(id);
                    else if (type === 'branches') selectedBranches.add(id);
                    else if (type === 'platforms') selectedPlatforms.add(id);
                    else if (type === 'pastOffers') selectedPastOffers.add(id);
                } else {
                    if (type === 'offers') selectedOffers.delete(id);
                    else if (type === 'sales') selectedSales.delete(id);
                    else if (type === 'branches') selectedBranches.delete(id);
                    else if (type === 'platforms') selectedPlatforms.delete(id);
                    else if (type === 'pastOffers') selectedPastOffers.delete(id);
                }
            }
        }
        
        function toggleSelectAll(type) {
            const selectAll = document.getElementById(`selectAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const checkboxes = document.querySelectorAll(`.${type}-checkbox`);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                toggleSelection(type, parseInt(checkbox.dataset.id));
            });
        }
        
        function duplicateSelectedOffer() {
            if (selectedOffers.size === 0) {
                showNotification('الرجاء اختيار عرض واحد على الأقل!', 'warning');
                return;
            }
            
            // Implementation for duplicating offers
            showNotification('تم نسخ العروض المحددة', 'success');
        }
        
        function archiveSelectedOffers() {
            if (selectedOffers.size === 0) {
                showNotification('الرجاء اختيار عرض واحد على الأقل!', 'warning');
                return;
            }
            
            selectedOffers.forEach(id => {
                archiveOffer(id);
            });
            
            selectedOffers.clear();
            showNotification('تم أرشفة العروض المحددة', 'success');
        }
        
        function deleteSelectedOffers() {
            if (selectedOffers.size === 0) {
                showNotification('الرجاء اختيار عرض واحد على الأقل!', 'warning');
                return;
            }
            
            if (confirm(`هل أنت متأكد من حذف ${selectedOffers.size} عرض؟`)) {
                selectedOffers.forEach(id => {
                    deleteOffer(id);
                });
                
                selectedOffers.clear();
                showNotification('تم حذف العروض المحددة', 'success');
            }
        }
        
        function bulkSalesEntry() {
            showNotification('ميزة الإدخال الجماعي قيد التطوير', 'info');
        }
        
        function exportSalesData() {
            showNotification('جاري تصدير بيانات المبيعات...', 'info');
            // Implementation for exporting sales data
        }
        
        function importOffers() {
            showNotification('ميزة الاستيراد قيد التطوير', 'info');
        }
        
        function exportOffers() {
            showNotification('جاري تصدير العروض...', 'info');
            // Implementation for exporting offers
        }
        
        function importBranches() {
            showNotification('ميزة الاستيراد من Excel قيد التطوير', 'info');
        }
        
        function showBranchesMap() {
            showNotification('ميزة الخريطة قيد التطوير', 'info');
        }
        
        function exportPastOffers() {
            showNotification('جاري تصدير تقرير العروض السابقة...', 'info');
            // Implementation for exporting past offers report
        }
        
        function resetFilters() {
            document.getElementById('branchFilter').value = '';
            document.getElementById('platformFilter').value = '';
            document.getElementById('offerFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            showNotification('تم إعادة تعيين الفلاتر', 'info');
        }
        
        function applyFilters() {
            showNotification('تم تطبيق الفلاتر بنجاح!', 'success');
            // Implementation for applying filters
        }
        
        function downloadChart(chartId) {
            showNotification('جاري تحميل الرسم البياني...', 'info');
            // Implementation for downloading chart
        }
        
        function toggleChartType(chartId) {
            showNotification('تم تغيير نوع الرسم البياني', 'info');
            // Implementation for toggling chart type
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        function showOfferDetails(id) {
            // Implementation for showing offer details
            showNotification('عرض تفاصيل العرض', 'info');
        }
        
        function showPastOfferDetails(id) {
            // Implementation for showing past offer details
            showNotification('عرض تفاصيل العرض السابق', 'info');
        }
        
        function editSale(id) {
            // Implementation for editing sale
            showNotification('تعديل سجل المبيعات', 'info');
        }
        
        // Global search
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            // Search in offers
            const offerResults = offers.filter(offer => 
                offer.name.toLowerCase().includes(searchTerm) ||
                offer.code.toLowerCase().includes(searchTerm)
            );
            
            // Search in branches
            const branchResults = branches.filter(branch =>
                branch.name.toLowerCase().includes(searchTerm) ||
                branch.code.toLowerCase().includes(searchTerm)
            );
            
            // Search in platforms
            const platformResults = platforms.filter(platform =>
                platform.name.toLowerCase().includes(searchTerm) ||
                platform.code.toLowerCase().includes(searchTerm)
            );
            
            // Display search results
            if (searchTerm) {
                console.log('Search Results:', {
                    offers: offerResults,
                    branches: branchResults,
                    platforms: platformResults
                });
            }
        });
        
        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            updateOffersTable();
            updateSalesTable();
            updateOfferSelects();
            updateBranchesList();
            updateBranchSelects();
            updatePlatformsList();
            updatePlatformSelects();
            updatePastOffersTable();
            updatePlatformsGrid();
            
            // Set default filter dates
            const today = new Date();
            const lastMonth = new Date(today);
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            
            document.getElementById('dateFrom').value = lastMonth.toISOString().split('T')[0];
            document.getElementById('dateTo').value = today.toISOString().split('T')[0];
            
            // Close modals on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab' && e.ctrlKey) {
                    e.preventDefault();
                    const tabs = Array.from(document.querySelectorAll('.tab'));
                    const activeTab = document.querySelector('.tab.active');
                    const currentIndex = tabs.indexOf(activeTab);
                    const nextIndex = (currentIndex + 1) % tabs.length;
                    tabs[nextIndex].click();
                }
            });
            
            // Show welcome message
            setTimeout(() => {
                showNotification('مرحباً بك في نظام إدارة العروض - Crispy Chicken', 'success', 7000);
            }, 1000);
            
            // Check for notifications
            checkNotifications();
        });
        
        // Check for notifications
        function checkNotifications() {
            // Check for expiring offers
            const today = new Date();
            const expiringOffers = offers.filter(offer => {
                const endDate = new Date(offer.endDate);
                const daysDiff = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysDiff <= 3 && daysDiff >= 0 && offer.status === 'نشط';
            });
            
            if (expiringOffers.length > 0) {
                showNotification(`يوجد ${expiringOffers.length} عروض ستنتهي خلال 3 أيام`, 'warning', 10000);
            }
            
            // Check for low stock alerts
            // Implementation for low stock alerts
        }
        
        // Auto-save functionality
        let autoSaveTimer;
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, textarea, select')) {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    saveData();
                    showNotification('تم الحفظ التلقائي', 'info', 2000);
                }, 5000);
            }
        });
        
        // Print functionality
        window.addEventListener('beforeprint', function() {
            document.querySelectorAll('.card').forEach(card => {
                card.style.boxShadow = 'none';
                card.style.border = '1px solid #ddd';
            });
        });
        
        window.addEventListener('afterprint', function() {
            location.reload();
        });
        
        // Add print button
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });
    </script>
</body>
</html>
